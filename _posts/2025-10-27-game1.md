---
title: Web vs å¾®ä¿¡å°æ¸¸æˆæ€§èƒ½ä¼˜åŒ–å¯¹æ¯”
tags:
article_header:
  type: cover
excerpt_separator: <!--more-->
---

## ä¸€ã€æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒå·®å¼‚

| ç»´åº¦ | Web å¹³å° | å¾®ä¿¡å°æ¸¸æˆ |
|------|---------|-----------|
| **ç“¶é¢ˆ** | ç½‘ç»œåŠ è½½ | åŒ…ä½“å¤§å°é™åˆ¶ |
| **ä¼˜åŒ–é‡ç‚¹** | é¦–å±é€Ÿåº¦ã€CDN | åˆ†åŒ…ç­–ç•¥ã€æœ¬åœ°ç¼“å­˜ |
| **èµ„æºç­–ç•¥** | æŒ‰éœ€è¿œç¨‹åŠ è½½ | é¢„åŠ è½½ + åˆ†åŒ… |
| **å†…å­˜é™åˆ¶** | å®½æ¾ï¼ˆæ•°GBï¼‰ | ä¸¥æ ¼ï¼ˆiOS < 500MBï¼‰ |
| **å®¡æ ¸è¦æ±‚** | æ—  | åŒ…ä½“ â‰¤ 20MB |

<!--more-->

## äºŒã€Web å¹³å°æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. é¦–å±åŠ è½½ä¼˜åŒ–ï¼ˆæœ€é‡è¦ï¼‰

#### **é—®é¢˜ï¼š**
ç”¨æˆ·æ‰“å¼€ H5 æ¸¸æˆéœ€è¦ä¸‹è½½å¤§é‡èµ„æºï¼Œç™½å±æ—¶é—´é•¿

#### **ä¼˜åŒ–æ–¹æ¡ˆï¼š**

```javascript
// âŒ é”™è¯¯åšæ³•ï¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰èµ„æº
cc.assetManager.loadBundle("resources", (err, bundle) => {
    bundle.loadDir("/", (err, assets) => {
        // åŠ è½½äº† 100MB èµ„æºï¼Œç”¨æˆ·ç­‰å¾… 30 ç§’
        startGame();
    });
});

// âœ… æ­£ç¡®åšæ³•ï¼šåˆ†é˜¶æ®µåŠ è½½
// é˜¶æ®µ 1ï¼šåªåŠ è½½ Loading ç•Œé¢èµ„æº (< 500KB)
cc.assetManager.loadBundle("loading", (err, bundle) => {
    bundle.load("prefabs/LoadingUI", (err, prefab) => {
        showLoadingUI(prefab);
        
        // é˜¶æ®µ 2ï¼šåœ¨ Loading ç•Œé¢æ˜¾ç¤ºæ—¶åŠ è½½æ ¸å¿ƒèµ„æº
        loadCoreAssets(() => {
            // é˜¶æ®µ 3ï¼šæ¸¸æˆè¿è¡ŒåæŒ‰éœ€åŠ è½½å…¶ä»–èµ„æº
            startGame();
        });
    });
});
```

#### **å…·ä½“å®è·µï¼š**

```typescript
// assets/Script/LoadingManager.ts
export class LoadingManager {
    // é¦–å±èµ„æºï¼ˆ< 500KBï¼‰
    private static PRELOAD_ASSETS = [
        "textures/logo",           // 100KB
        "textures/loading_bg",     // 200KB
        "prefabs/LoadingUI",       // 50KB
        "audio/bg_music_short"     // 150KBï¼ˆçŸ­å¾ªç¯éŸ³ä¹ï¼‰
    ];
    
    // æ ¸å¿ƒèµ„æºï¼ˆ1-2MBï¼‰
    private static CORE_ASSETS = [
        "prefabs/MainUI",
        "prefabs/GameScene",
        "textures/common_atlas",   // å›¾é›†
        "audio/click_sound"
    ];
    
    // æŒ‰éœ€åŠ è½½èµ„æº
    private static LAZY_ASSETS = {
        "shop": ["prefabs/ShopUI", "textures/shop_items"],
        "level2": ["scenes/Level2", "textures/level2_bg"],
        "vip": ["prefabs/VipUI", "textures/vip_icons"]
    };
    
    public async loadFirstScreen() {
        // åªåŠ è½½ 500KBï¼Œ1ç§’å†…å®Œæˆ
        await this.loadAssets(LoadingManager.PRELOAD_ASSETS);
        this.showLoadingUI();
    }
    
    public async loadCoreAssets(onProgress: (percent: number) => void) {
        // åŠ è½½æ ¸å¿ƒèµ„æºï¼Œæ˜¾ç¤ºè¿›åº¦æ¡
        await this.loadAssets(LoadingManager.CORE_ASSETS, onProgress);
    }
    
    public async loadLazyAssets(scene: string) {
        // è¿›å…¥æŸä¸ªåœºæ™¯æ—¶æ‰åŠ è½½
        const assets = LoadingManager.LAZY_ASSETS[scene];
        if (assets) {
            await this.loadAssets(assets);
        }
    }
}
```

---

### 2. CDN å’Œç¼“å­˜ç­–ç•¥

#### **CDN é…ç½®ï¼š**

```javascript
// build/web-mobile/settings.js
window._CCSettings = {
    server: "https://cdn.example.com/game-v1.2.3/",
    
    bundleVers: {
        internal: "a1b2c",      // ğŸ‘ˆ ç‰ˆæœ¬å·ç”¨äºç¼“å­˜æ§åˆ¶
        resources: "d3e4f",
        main: "g5h6i"
    }
};
```

#### **HTTP ç¼“å­˜å¤´é…ç½®ï¼š**

```nginx
# Nginx é…ç½®ç¤ºä¾‹
location /game-v1.2.3/ {
    # JSON é…ç½®æ–‡ä»¶ï¼šçŸ­ç¼“å­˜
    location ~ \.json$ {
        add_header Cache-Control "public, max-age=300";  # 5åˆ†é’Ÿ
    }
    
    # å›¾ç‰‡/éŸ³é¢‘ï¼šé•¿ç¼“å­˜
    location ~ \.(png|jpg|mp3|mp4)$ {
        add_header Cache-Control "public, max-age=31536000";  # 1å¹´
        add_header Access-Control-Allow-Origin *;
    }
    
    # JavaScriptï¼šä¸­ç­‰ç¼“å­˜
    location ~ \.js$ {
        add_header Cache-Control "public, max-age=86400";  # 1å¤©
    }
    
    # å¯ç”¨ Gzip å‹ç¼©
    gzip on;
    gzip_types application/json application/javascript image/png;
    gzip_min_length 1024;
}
```

#### **é¢„åŠ è½½å…³é”®èµ„æºï¼š**

```html
<!-- build/web-mobile/index.html -->
<!DOCTYPE html>
<html>
<head>
    <!-- ğŸ‘‡ é¢„è¿æ¥åˆ° CDN -->
    <link rel="preconnect" href="https://cdn.example.com">
    <link rel="dns-prefetch" href="https://cdn.example.com">
    
    <!-- ğŸ‘‡ é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preload" href="src/cocos2d-js-min.js" as="script">
    <link rel="preload" href="res/import/00/00abc123.png" as="image">
    
    <!-- ğŸ‘‡ å†…è”å…³é”® CSSï¼ˆé¿å…é¢å¤–è¯·æ±‚ï¼‰ -->
    <style>
        body { margin: 0; background: #000; }
        #GameCanvas { display: block; }
    </style>
</head>
<body>
    <canvas id="GameCanvas"></canvas>
</body>
</html>
```

---

### 3. èµ„æºå‹ç¼©ä¼˜åŒ–

#### **çº¹ç†å‹ç¼©ï¼š**

```typescript
// Cocos Creator èµ„æºé¢æ¿è®¾ç½®
çº¹ç†è®¾ç½®ï¼š
- æ ¼å¼ï¼šWebP (Chrome)ã€PNG (Safari)
- å‹ç¼©ï¼šASTC/ETC2 (ä¸æ”¯æŒæ—¶é™çº§ä¸º PNG)
- å¤§å°ï¼šè‡ªåŠ¨ç”Ÿæˆå¤šç§å°ºå¯¸
    - @2x: 2048x2048 (é«˜æ¸…å±)
    - @1x: 1024x1024 (æ™®é€šå±)
```

#### **å›¾é›†åˆå¹¶ï¼š**

```
âŒ é”™è¯¯ï¼š100 ä¸ªç‹¬ç«‹å°å›¾
textures/
â”œâ”€â”€ icon_coin.png       (10KB Ã— 100 = 1MB)
â”œâ”€â”€ icon_gem.png        
â”œâ”€â”€ icon_star.png       
â””â”€â”€ ... (97 ä¸ªæ–‡ä»¶)

âœ… æ­£ç¡®ï¼šåˆå¹¶æˆ 1 ä¸ªå›¾é›†
textures/
â””â”€â”€ common_atlas/
    â”œâ”€â”€ common_atlas.png       (500KBï¼ŒåŒ…å« 100 ä¸ªå°å›¾)
    â”œâ”€â”€ common_atlas.plist     (é…ç½®æ–‡ä»¶)
    â””â”€â”€ å‡å°‘ 99 æ¬¡ HTTP è¯·æ±‚ï¼
```

#### **éŸ³é¢‘å‹ç¼©ï¼š**

```typescript
// éŸ³é¢‘èµ„æºé…ç½®
éŸ³é¢‘è®¾ç½®ï¼š
- BGMï¼š
    - æ ¼å¼ï¼šMP3 (iOS/Android é€šç”¨)
    - ç ç‡ï¼š64kbps (å¾ªç¯éŸ³ä¹)
    - æ—¶é•¿ï¼š10ç§’å¾ªç¯ (è€Œä¸æ˜¯ 2åˆ†é’Ÿå®Œæ•´ç‰ˆ)
    
- éŸ³æ•ˆï¼š
    - æ ¼å¼ï¼šMP3
    - ç ç‡ï¼š32kbps
    - æ—¶é•¿ï¼š< 2ç§’
```

---

### 4. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

#### **Webpack ä»£ç åˆ†å‰²ï¼š**

```javascript
// assets/Script/Utils/LazyLoader.ts
export class LazyLoader {
    // æŒ‰æ¨¡å—åŠ¨æ€å¯¼å…¥
    public static async loadShopModule() {
        // ğŸ‘‡ åªåœ¨æ‰“å¼€å•†åŸæ—¶åŠ è½½ç›¸å…³ä»£ç 
        const { ShopManager } = await import(
            /* webpackChunkName: "shop" */
            './Modules/ShopManager'
        );
        return ShopManager;
    }
    
    public static async loadBattleModule() {
        const { BattleSystem } = await import(
            /* webpackChunkName: "battle" */
            './Modules/BattleSystem'
        );
        return BattleSystem;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
async openShop() {
    const ShopManager = await LazyLoader.loadShopModule();
    ShopManager.show();
}
```

**æ„å»ºåçš„ç›®å½•ï¼š**

```
build/web-mobile/src/
â”œâ”€â”€ project.js          # ä¸»åŒ… (200KB)
â”œâ”€â”€ shop.chunk.js       # å•†åŸæ¨¡å— (50KB)
â”œâ”€â”€ battle.chunk.js     # æˆ˜æ–—æ¨¡å— (80KB)
â””â”€â”€ vip.chunk.js        # VIP æ¨¡å— (30KB)
```

---

### 5. Web Worker ä¼˜åŒ–

#### **è€—æ—¶è®¡ç®—ç§»åˆ° Workerï¼š**

```typescript
// assets/Script/Workers/PathFindingWorker.ts
// ğŸ‘‡ åœ¨ç‹¬ç«‹çº¿ç¨‹è®¡ç®—è·¯å¾„ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹

// ä¸»çº¿ç¨‹ä»£ç 
const worker = new Worker('workers/pathfinding.js');

worker.postMessage({
    start: { x: 0, y: 0 },
    end: { x: 100, y: 100 },
    obstacles: [...]
});

worker.onmessage = (e) => {
    const path = e.data.path;
    this.moveAlongPath(path);
};

// workers/pathfinding.js
self.onmessage = (e) => {
    const { start, end, obstacles } = e.data;
    
    // å¤æ‚çš„ A* ç®—æ³•è®¡ç®—ï¼ˆå¯èƒ½éœ€è¦ 100msï¼‰
    const path = calculatePath(start, end, obstacles);
    
    self.postMessage({ path });
};
```

---

## ä¸‰ã€å¾®ä¿¡å°æ¸¸æˆæ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. åŒ…ä½“å¤§å°ä¼˜åŒ–ï¼ˆæœ€é‡è¦ï¼‰

#### **é—®é¢˜ï¼šå¾®ä¿¡å®¡æ ¸è¦æ±‚**

```
ä¸»åŒ… â‰¤ 4MB
å•ä¸ªåˆ†åŒ… â‰¤ 4MB
æ€»åŒ…ä½“ â‰¤ 20MB
```

#### **åˆ†åŒ…ç­–ç•¥ï¼š**

```javascript
// project.config.json
{
  "subpackages": [
    {
      "name": "main",
      "root": "subpackages/main/",
      "pages": []  // å°æ¸¸æˆæ— æ­¤å­—æ®µ
    },
    {
      "name": "shop",
      "root": "subpackages/shop/"
    },
    {
      "name": "battle",
      "root": "subpackages/battle/"
    }
  ],
  
  // ğŸ‘‡ é¢„ä¸‹è½½åˆ†åŒ…ï¼ˆè¿›å…¥ä¸»ç•Œé¢æ—¶è‡ªåŠ¨ä¸‹è½½ï¼‰
  "preloadSubpackages": {
    "main": {
      "network": "all",          // WiFi æˆ– æµé‡
      "download_num_limit": 2    // æœ€å¤šåŒæ—¶ä¸‹è½½ 2 ä¸ª
    }
  }
}
```

#### **èµ„æºåˆ†é…ç¤ºä¾‹ï¼š**

```
ä¸»åŒ… (3.8MB)ï¼š
â”œâ”€â”€ game.js                    (1.2MB) - å¼•æ“ + æ ¸å¿ƒä»£ç 
â”œâ”€â”€ settings.js                (10KB)
â””â”€â”€ assets/
    â”œâ”€â”€ internal/              (500KB) - å¼•æ“å†…ç½®èµ„æº
    â”œâ”€â”€ resources/             (1.5MB) - Loading + ä¸»ç•Œé¢
    â”‚   â”œâ”€â”€ textures/logo.png
    â”‚   â”œâ”€â”€ textures/loading_bg.png
    â”‚   â””â”€â”€ prefabs/MainUI.prefab
    â””â”€â”€ main/                  (600KB) - å¯åŠ¨åœºæ™¯

åˆ†åŒ… 1: shop (3.5MB)
â””â”€â”€ subpackages/shop/
    â”œâ”€â”€ textures/shop_bg.png       (1MB)
    â”œâ”€â”€ textures/item_icons.png    (2MB)
    â””â”€â”€ prefabs/ShopUI.prefab      (500KB)

åˆ†åŒ… 2: battle (4MB)
â””â”€â”€ subpackages/battle/
    â”œâ”€â”€ textures/battle_atlas.png  (2.5MB)
    â”œâ”€â”€ audio/battle_bgm.mp3       (1MB)
    â””â”€â”€ prefabs/BattleScene.prefab (500KB)
```

---

### 2. çº¹ç†å‹ç¼©ç­–ç•¥

#### **å¾®ä¿¡å°æ¸¸æˆæ”¯æŒçš„æ ¼å¼ï¼š**

```typescript
// Cocos Creator çº¹ç†è®¾ç½®
çº¹ç†å‹ç¼©ï¼š
- Androidï¼š
    - ETC2 (æ¨è)
    - ASTC (å¤‡é€‰)
    - é™çº§ï¼šPNG
    
- iOSï¼š
    - ASTC (æ¨è)
    - PVRTC (æ—§è®¾å¤‡)
    - é™çº§ï¼šPNG

å‹ç¼©æ¯”å¯¹æ¯”ï¼š
- PNGï¼š1024x1024 = 2MB
- ETC2ï¼š1024x1024 = 512KB (å‹ç¼© 75%)
- ASTCï¼š1024x1024 = 256KB (å‹ç¼© 87%)
```

#### **ä»£ç ç¤ºä¾‹ï¼š**

```typescript
// æ ¹æ®å¹³å°é€‰æ‹©çº¹ç†æ ¼å¼
export class TextureManager {
    public static getOptimalFormat(): string {
        const sys = cc.sys;
        
        if (sys.os === sys.OS_IOS) {
            // iOS ä¼˜å…ˆä½¿ç”¨ ASTC
            return sys.capabilities.astc ? 'astc' : 'pvrtc';
        } else if (sys.os === sys.OS_ANDROID) {
            // Android ä¼˜å…ˆä½¿ç”¨ ETC2
            return sys.capabilities.etc2 ? 'etc2' : 'etc1';
        }
        
        // é™çº§åˆ° PNG
        return 'png';
    }
}
```

---

### 3. å†…å­˜ç®¡ç†ï¼ˆå…³é”®ï¼‰

#### **é—®é¢˜ï¼šå¾®ä¿¡å°æ¸¸æˆå†…å­˜é™åˆ¶**

```
iOSï¼š
- iPhone 6/7/8ï¼š< 500MB
- iPhone X åŠä»¥ä¸Šï¼š< 700MB
- è¶…å‡ºé™åˆ¶ä¼šè¢«å¼ºåˆ¶å…³é—­

Androidï¼š
- ä½ç«¯æœºï¼š< 300MB
- ä¸­ç«¯æœºï¼š< 500MB
- é«˜ç«¯æœºï¼š< 1GB
```

#### **å†…å­˜ç›‘æ§ï¼š**

```typescript
// assets/Script/Manager/MemoryMonitor.ts
export class MemoryMonitor {
    private static warningThreshold = 400 * 1024 * 1024;  // 400MB
    private static criticalThreshold = 500 * 1024 * 1024; // 500MB
    
    public static startMonitoring() {
        setInterval(() => {
            if (wx) {
                const info = wx.getPerformance().getMemoryInfo();
                const usedMemory = info.usedJSHeapSize;
                
                console.log(`å†…å­˜ä½¿ç”¨: ${(usedMemory / 1024 / 1024).toFixed(2)}MB`);
                
                if (usedMemory > this.criticalThreshold) {
                    // ç´§æ€¥æ¸…ç†
                    this.emergencyCleanup();
                } else if (usedMemory > this.warningThreshold) {
                    // ä¸»åŠ¨æ¸…ç†
                    this.cleanupUnusedAssets();
                }
            }
        }, 5000);  // æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡
    }
    
    private static emergencyCleanup() {
        // 1. é‡Šæ”¾æ‰€æœ‰éå½“å‰åœºæ™¯çš„èµ„æº
        cc.assetManager.releaseAll();
        
        // 2. æ¸…ç†çº¹ç†ç¼“å­˜
        cc.director.getScene().children.forEach(node => {
            if (!node.active) {
                node.destroy();
            }
        });
        
        // 3. å¼ºåˆ¶ GCï¼ˆå¦‚æœæ”¯æŒï¼‰
        if (wx && wx.triggerGC) {
            wx.triggerGC();
        }
        
        console.warn('æ‰§è¡Œç´§æ€¥å†…å­˜æ¸…ç†');
    }
    
    private static cleanupUnusedAssets() {
        // é‡Šæ”¾è¶…è¿‡ 5 åˆ†é’Ÿæœªä½¿ç”¨çš„èµ„æº
        const now = Date.now();
        const unusedAssets = this.getUnusedAssets(now - 5 * 60 * 1000);
        
        unusedAssets.forEach(asset => {
            cc.assetManager.releaseAsset(asset);
        });
    }
}
```

---

### 4. åˆ†åŒ…åŠ è½½ä¼˜åŒ–

#### **æ™ºèƒ½é¢„åŠ è½½ï¼š**

```typescript
// assets/Script/Manager/SubpackageLoader.ts
export class SubpackageLoader {
    private static loadedPackages = new Set<string>();
    
    // æ ¹æ®ç”¨æˆ·è¡Œä¸ºé¢„æµ‹éœ€è¦çš„åˆ†åŒ…
    public static async preloadByUserAction(action: string) {
        const packageMap = {
            'click_shop_btn': 'shop',      // ç‚¹å‡»å•†åŸæŒ‰é’®
            'enter_battle': 'battle',       // è¿›å…¥æˆ˜æ–—
            'open_settings': 'settings'     // æ‰“å¼€è®¾ç½®
        };
        
        const packageName = packageMap[action];
        if (packageName && !this.loadedPackages.has(packageName)) {
            console.log(`é¢„åŠ è½½åˆ†åŒ…: ${packageName}`);
            await this.loadSubpackage(packageName);
        }
    }
    
    private static async loadSubpackage(name: string): Promise<void> {
        return new Promise((resolve, reject) => {
            const task = wx.loadSubpackage({
                name: name,
                success: () => {
                    console.log(`åˆ†åŒ… ${name} åŠ è½½æˆåŠŸ`);
                    this.loadedPackages.add(name);
                    
                    // åŠ è½½åˆ†åŒ…ä¸­çš„èµ„æº Bundle
                    cc.assetManager.loadBundle(name, (err, bundle) => {
                        if (err) {
                            reject(err);
                        } else {
                            resolve();
                        }
                    });
                },
                fail: (err) => {
                    console.error(`åˆ†åŒ… ${name} åŠ è½½å¤±è´¥`, err);
                    reject(err);
                }
            });
            
            // æ˜¾ç¤ºä¸‹è½½è¿›åº¦
            task.onProgressUpdate((res) => {
                console.log(`ä¸‹è½½è¿›åº¦: ${res.progress}%`);
                this.updateLoadingProgress(res.progress);
            });
        });
    }
    
    // ç”¨æˆ·ç‚¹å‡»å•†åŸæŒ‰é’®æ—¶
    public static async openShop() {
        // æ˜¾ç¤º Loading
        this.showLoading();
        
        // åŠ è½½åˆ†åŒ…
        await this.loadSubpackage('shop');
        
        // åŠ è½½å•†åŸèµ„æº
        const bundle = cc.assetManager.getBundle('shop');
        bundle.load('prefabs/ShopUI', cc.Prefab, (err, prefab) => {
            this.hideLoading();
            
            if (!err) {
                const node = cc.instantiate(prefab);
                cc.director.getScene().addChild(node);
            }
        });
    }
}
```

---

### 5. å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–

#### **é¦–å±èµ„æºæœ€å°åŒ–ï¼š**

```typescript
// ä¸»åŒ…åªåŒ…å«å¿…è¦èµ„æº
ä¸»åŒ…èµ„æº (< 2MB)ï¼š
â”œâ”€â”€ Logo (50KB)
â”œâ”€â”€ Loading èƒŒæ™¯ (200KB)
â”œâ”€â”€ Loading è¿›åº¦æ¡ (20KB)
â”œâ”€â”€ ä¸»ç•Œé¢ UI (500KB)
â””â”€â”€ çŸ­å¾ªç¯ BGM (500KB)

// âŒ ä¸è¦åœ¨ä¸»åŒ…æ”¾è¿™äº›ï¼š
âœ— æ‰€æœ‰å…³å¡èƒŒæ™¯ (5MB)
âœ— å®Œæ•´ BGM (2MB)
âœ— æ‰€æœ‰è§’è‰²æ¨¡å‹ (10MB)
```

#### **ä»£ç å¯åŠ¨ä¼˜åŒ–ï¼š**

```typescript
// assets/Script/Main.ts
export class Main extends cc.Component {
    onLoad() {
        // âŒ é”™è¯¯ï¼šåœ¨ onLoad ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
        this.initAllSystems();      // 500ms
        this.loadAllConfigs();      // 300ms
        this.preloadAllAssets();    // 2000ms
        
        // âœ… æ­£ç¡®ï¼šå»¶è¿Ÿåˆå§‹åŒ–
        this.quickInit();
        
        // æ˜¾ç¤ºä¸»ç•Œé¢åå†åˆå§‹åŒ–å…¶ä»–ç³»ç»Ÿ
        this.scheduleOnce(() => {
            this.initNonCriticalSystems();
        }, 0.5);
    }
    
    private quickInit() {
        // åªåˆå§‹åŒ–å…³é”®ç³»ç»Ÿ (< 100ms)
        this.initEventManager();
        this.initAudioManager();
        
        // æ˜¾ç¤ºä¸»ç•Œé¢
        this.showMainUI();
    }
    
    private initNonCriticalSystems() {
        // å¼‚æ­¥åˆå§‹åŒ–éå…³é”®ç³»ç»Ÿ
        Promise.all([
            this.loadGameConfigs(),
            this.initAnalytics(),
            this.initAds(),
            this.preloadCommonAssets()
        ]).then(() => {
            console.log('æ‰€æœ‰ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        });
    }
}
```

---

### 6. å¯¹è±¡æ± ä¼˜åŒ–

#### **é—®é¢˜ï¼šé¢‘ç¹åˆ›å»º/é”€æ¯èŠ‚ç‚¹å¯¼è‡´å¡é¡¿**

```typescript
// âŒ é”™è¯¯ï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°èŠ‚ç‚¹
fireBullet() {
    cc.resources.load('prefabs/Bullet', cc.Prefab, (err, prefab) => {
        const bullet = cc.instantiate(prefab);  // æ¯æ¬¡ instantiate éƒ½ä¼šè§¦å‘ GC
        this.node.addChild(bullet);
        
        // å­å¼¹é£å‡ºå±å¹•åé”€æ¯
        bullet.runAction(cc.sequence(
            cc.moveTo(2, 1000, 0),
            cc.callFunc(() => {
                bullet.destroy();  // é¢‘ç¹é”€æ¯å¯¼è‡´å†…å­˜æŠ–åŠ¨
            })
        ));
    });
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å¯¹è±¡æ± 
export class BulletPool {
    private static pool: cc.NodePool = null;
    private static prefab: cc.Prefab = null;
    
    public static init(prefab: cc.Prefab) {
        this.prefab = prefab;
        this.pool = new cc.NodePool();
        
        // é¢„åˆ›å»º 20 ä¸ªå­å¼¹
        for (let i = 0; i < 20; i++) {
            const bullet = cc.instantiate(prefab);
            this.pool.put(bullet);
        }
    }
    
    public static get(): cc.Node {
        let bullet = this.pool.get();
        if (!bullet) {
            bullet = cc.instantiate(this.prefab);
        }
        return bullet;
    }
    
    public static put(bullet: cc.Node) {
        this.pool.put(bullet);
    }
}

// ä½¿ç”¨å¯¹è±¡æ± 
fireBullet() {
    const bullet = BulletPool.get();
    this.node.addChild(bullet);
    
    bullet.runAction(cc.sequence(
        cc.moveTo(2, 1000, 0),
        cc.callFunc(() => {
            BulletPool.put(bullet);  // å›æ”¶è€Œä¸æ˜¯é”€æ¯
        })
    ));
}
```

---

## å››ã€æ€§èƒ½ä¼˜åŒ–å¯¹æ¯”æ€»ç»“

### 1. ä¼˜åŒ–ä¼˜å…ˆçº§å¯¹æ¯”

#### **Web å¹³å°ä¼˜åŒ–ä¼˜å…ˆçº§ï¼š**

```
1. â­â­â­â­â­ é¦–å±åŠ è½½é€Ÿåº¦
   - CDN é…ç½®
   - èµ„æºæ‡’åŠ è½½
   - ä»£ç åˆ†å‰²

2. â­â­â­â­ ç½‘ç»œä¼˜åŒ–
   - HTTP/2
   - Gzip å‹ç¼©
   - èµ„æºé¢„åŠ è½½

3. â­â­â­ ç¼“å­˜ç­–ç•¥
   - ServiceWorker
   - LocalStorage
   - IndexedDB

4. â­â­ è¿è¡Œæ—¶æ€§èƒ½
   - å†…å­˜ç®¡ç†
   - æ¸²æŸ“ä¼˜åŒ–
```

#### **å¾®ä¿¡å°æ¸¸æˆä¼˜åŒ–ä¼˜å…ˆçº§ï¼š**

```
1. â­â­â­â­â­ åŒ…ä½“å¤§å°
   - çº¹ç†å‹ç¼©
   - åˆ†åŒ…ç­–ç•¥
   - ä»£ç ç²¾ç®€

2. â­â­â­â­â­ å†…å­˜ç®¡ç†
   - å¯¹è±¡æ± 
   - èµ„æºé‡Šæ”¾
   - å†…å­˜ç›‘æ§

3. â­â­â­â­ å¯åŠ¨é€Ÿåº¦
   - é¦–åŒ…æœ€å°åŒ–
   - å»¶è¿Ÿåˆå§‹åŒ–
   - åˆ†åŒ…é¢„åŠ è½½

4. â­â­â­ å…¼å®¹æ€§
   - ä½ç«¯æœºé€‚é…
   - iOS/Android å·®å¼‚
```

---

### 2. æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | Web å¹³å°ç›®æ ‡ | å¾®ä¿¡å°æ¸¸æˆç›®æ ‡ |
|------|------------|--------------|
| **é¦–å±æ—¶é—´** | < 3 ç§’ | < 2 ç§’ |
| **ç™½å±æ—¶é—´** | < 1 ç§’ | < 0.5 ç§’ |
| **FPS** | â‰¥ 30 | â‰¥ 60 (æ—§è®¾å¤‡ â‰¥ 30) |
| **å†…å­˜å ç”¨** | < 200MB (ç§»åŠ¨ç«¯) | < 400MB (iOS) |
| **åŒ…ä½“å¤§å°** | æ— é™åˆ¶ | â‰¤ 20MB |
| **é¦–åŒ…å¤§å°** | < 2MB | â‰¤ 4MB |

---

### 3. å·¥å…·å’Œç›‘æ§å¯¹æ¯”

#### **Web å¹³å°å·¥å…·ï¼š**

```javascript
// Chrome DevTools
// 1. Network é¢æ¿
// - åˆ†æèµ„æºåŠ è½½ç€‘å¸ƒå›¾
// - æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
// - æµ‹é‡ TTFB (Time To First Byte)

// 2. Performance é¢æ¿
// - å½•åˆ¶è¿è¡Œæ—¶æ€§èƒ½
// - æŸ¥çœ‹å¸§ç‡
// - åˆ†æ JS æ‰§è¡Œæ—¶é—´

// 3. Lighthouse
// - è‡ªåŠ¨åŒ–æ€§èƒ½æµ‹è¯•
// - ç”Ÿæˆä¼˜åŒ–å»ºè®®

// ä»£ç ä¸­åµŒå…¥æ€§èƒ½ç›‘æ§
if (window.performance) {
    const timing = performance.timing;
    const loadTime = timing.loadEventEnd - timing.navigationStart;
    console.log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`);
    
    // ä¸ŠæŠ¥åˆ°åˆ†æå¹³å°
    analytics.report('page_load_time', loadTime);
}
```

#### **å¾®ä¿¡å°æ¸¸æˆå·¥å…·ï¼š**

```javascript
// å¾®ä¿¡å¼€å‘è€…å·¥å…·
// 1. æ€§èƒ½é¢æ¿
// - å®æ—¶æŸ¥çœ‹ FPS
// - å†…å­˜å ç”¨æ›²çº¿
// - CPU ä½¿ç”¨ç‡

// 2. çœŸæœºè°ƒè¯•
// - åœ¨çœŸå®è®¾å¤‡ä¸Šæµ‹è¯•
// - æŸ¥çœ‹ä½ç«¯æœºæ€§èƒ½

// ä»£ç ä¸­åµŒå…¥æ€§èƒ½ç›‘æ§
if (wx) {
    const performance = wx.getPerformance();
    
    // ç›‘æ§ FPS
    setInterval(() => {
        const fps = performance.getFPS();
        if (fps < 30) {
            console.warn(`FPS è¿‡ä½: ${fps}`);
            // é™ä½ç”»è´¨
            this.reducedQuality();
        }
    }, 1000);
    
    // ç›‘æ§å†…å­˜
    setInterval(() => {
        const memory = performance.getMemoryInfo();
        console.log(`å†…å­˜ä½¿ç”¨: ${(memory.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB`);
        
        if (memory.usedJSHeapSize > 400 * 1024 * 1024) {
            // æ¸…ç†èµ„æº
            this.cleanupAssets();
        }
    }, 5000);
}
```

---

### 4. èµ„æºç®¡ç†ç­–ç•¥å¯¹æ¯”

#### **Web å¹³å°ï¼š**

```typescript
// è¿œç¨‹åŠ è½½ç­–ç•¥
export class WebAssetManager {
    // CDN èµ„æºåˆ—è¡¨
    private static CDN_BASE = "https://cdn.example.com/";
    
    // å…³é”®èµ„æºé¢„åŠ è½½
    public static preloadCriticalAssets() {
        const criticalAssets = [
            "res/textures/logo.png",
            "res/textures/loading_bg.png"
        ];
        
        // ä½¿ç”¨ Image å¯¹è±¡é¢„åŠ è½½
        criticalAssets.forEach(url => {
            const img = new Image();
            img.src = this.CDN_BASE + url;
        });
    }
    
    // æŒ‰éœ€åŠ è½½éå…³é”®èµ„æº
    public static async loadAssetWhenNeeded(bundleName: string) {
        // æ£€æŸ¥æ˜¯å¦å·²ç¼“å­˜
        if (this.isCached(bundleName)) {
            return this.loadFromCache(bundleName);
        }
        
        // ä» CDN åŠ è½½
        return new Promise((resolve, reject) => {
            cc.assetManager.loadBundle(bundleName, (err, bundle) => {
                if (err) {
                    reject(err);
                } else {
                    // ç¼“å­˜åˆ° IndexedDB
                    this.cacheBundle(bundle);
                    resolve(bundle);
                }
            });
        });
    }
}
```

#### **å¾®ä¿¡å°æ¸¸æˆï¼š**

```typescript
// åˆ†åŒ…åŠ è½½ç­–ç•¥
export class WechatAssetManager {
    private static loadedSubpackages = new Set<string>();
    
    // å¯åŠ¨æ—¶åªåŠ è½½ä¸»åŒ…
    public static async loadMainPackage() {
        // ä¸»åŒ…å·²ç»è‡ªåŠ¨åŠ è½½ï¼Œåªéœ€åŠ è½½å¿…è¦çš„ Bundle
        await this.loadBundle('internal');
        await this.loadBundle('resources');
    }
    
    // é¢„æµ‹å¼åŠ è½½åˆ†åŒ…
    public static async predictiveLoadSubpackage(userAction: string) {
        const predictions = {
            'hover_shop_btn': 'shop',      // é¼ æ ‡æ‚¬åœå°±å¼€å§‹é¢„åŠ è½½
            'scroll_to_level': 'battle',   // æ»šåŠ¨åˆ°å…³å¡å°±é¢„åŠ è½½
            'open_menu': 'settings'        // æ‰“å¼€èœå•é¢„åŠ è½½è®¾ç½®
        };
        
        const packageName = predictions[userAction];
        if (packageName && !this.loadedSubpackages.has(packageName)) {
            // åå°é™é»˜åŠ è½½
            this.loadSubpackageInBackground(packageName);
        }
    }
    
    private static async loadSubpackageInBackground(name: string) {
        wx.loadSubpackage({
            name: name,
            success: () => {
                this.loadedSubpackages.add(name);
                console.log(`åå°åŠ è½½åˆ†åŒ…æˆåŠŸ: ${name}`);
            }
        });
    }
}
```

---

## äº”ã€å®æˆ˜æ¡ˆä¾‹å¯¹æ¯”

### æ¡ˆä¾‹ï¼šä¸€ä¸ªä¸­å‹æ¸¸æˆçš„ä¼˜åŒ–ç»“æœ

#### **æ¸¸æˆè§„æ¨¡ï¼š**

```
- 10 ä¸ªåœºæ™¯
- 500+ å¼ çº¹ç†
- 50+ ä¸ªé¢„åˆ¶ä½“
- 30+ ä¸ªéŸ³é¢‘æ–‡ä»¶
```

#### **Web å¹³å°ä¼˜åŒ–å‰åï¼š**

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| é¦–å±æ—¶é—´ | 8.5s | 2.3s | â¬†ï¸ 73% |
| é¦–åŒ…å¤§å° | 5.2MB | 1.1MB | â¬‡ï¸ 79% |
| åŠ è½½èµ„æºæ•° | 150 ä¸ª | 25 ä¸ª | â¬‡ï¸ 83% |
| ç¼“å­˜å‘½ä¸­ç‡ | 40% | 85% | â¬†ï¸ 113% |

**ä¼˜åŒ–æªæ–½ï¼š**

1. å¯ç”¨ CDN + HTTP/2
2. å›¾ç‰‡ä½¿ç”¨ WebP æ ¼å¼
3. åˆå¹¶å°å›¾æˆå›¾é›†ï¼ˆ150 â†’ 15ï¼‰
4. ä»£ç åˆ†å‰²ï¼ˆ5 ä¸ª chunkï¼‰
5. é¦–å±åªåŠ è½½ Loading + ä¸»ç•Œé¢

---

#### **å¾®ä¿¡å°æ¸¸æˆä¼˜åŒ–å‰åï¼š**

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| æ€»åŒ…ä½“ | 25MB âŒ | 18MB âœ… | â¬‡ï¸ 28% |
| ä¸»åŒ…å¤§å° | 6MB âŒ | 3.5MB âœ… | â¬‡ï¸ 42% |
| å¯åŠ¨æ—¶é—´ | 3.2s | 1.1s | â¬†ï¸ 66% |
| å†…å­˜å ç”¨ | 550MB âŒ | 380MB âœ… | â¬‡ï¸ 31% |
| ä½ç«¯æœº FPS | 25 | 50 | â¬†ï¸ 100% |

**ä¼˜åŒ–æªæ–½ï¼š**

1. çº¹ç†å…¨éƒ¨ä½¿ç”¨ ASTC/ETC2 å‹ç¼©
2. å°† 10 ä¸ªåœºæ™¯æ‹†åˆ†æˆ 5 ä¸ªåˆ†åŒ…
3. å¯ç”¨å¯¹è±¡æ± ï¼ˆå­å¼¹ã€ç‰¹æ•ˆï¼‰
4. éŸ³é¢‘æ”¹ç”¨ 32kbps MP3
5. ç§»é™¤æœªä½¿ç”¨çš„å¼•æ“æ¨¡å—

---

## å…­ã€æ€»ç»“ä¸å»ºè®®

### Web å¹³å°ä¼˜åŒ–æ ¸å¿ƒ

```
å…³æ³¨ç‚¹ï¼šé¦–å±é€Ÿåº¦ > èµ„æºå¤§å° > è¿è¡Œæ€§èƒ½

æ ¸å¿ƒç­–ç•¥ï¼š
1. æè‡´å‹ç¼©é¦–å±èµ„æº (< 1MB)
2. å……åˆ†åˆ©ç”¨ CDN å’Œç¼“å­˜
3. å»¶è¿ŸåŠ è½½éå…³é”®èµ„æº
4. ä½¿ç”¨ç°ä»£ Web æŠ€æœ¯ (WebP, HTTP/2)
```

### å¾®ä¿¡å°æ¸¸æˆä¼˜åŒ–æ ¸å¿ƒ

```
å…³æ³¨ç‚¹ï¼šåŒ…ä½“å¤§å° > å†…å­˜ç®¡ç† > å¯åŠ¨é€Ÿåº¦

æ ¸å¿ƒç­–ç•¥ï¼š
1. ä¸¥æ ¼æ§åˆ¶åŒ…ä½“ (ä¸»åŒ… < 4MB)
2. æ¿€è¿›çš„çº¹ç†å‹ç¼© (ASTC/ETC2)
3. æ™ºèƒ½åˆ†åŒ… + é¢„åŠ è½½
4. ä¸»åŠ¨å†…å­˜ç®¡ç† + å¯¹è±¡æ± 
5. é€‚é…ä½ç«¯è®¾å¤‡
```

### å¼€å‘å»ºè®®

```
Web å¹³å°ï¼š
âœ… ä¼˜å…ˆè€ƒè™‘ CDN éƒ¨ç½²
âœ… ä½¿ç”¨ Lighthouse å®šæœŸæ£€æµ‹
âœ… å…³æ³¨ç§»åŠ¨ç½‘ç»œç¯å¢ƒ (3G/4G)
âœ… å®ç°æ¸è¿›å¼åŠ è½½

å¾®ä¿¡å°æ¸¸æˆï¼š
âœ… ä»ç¬¬ä¸€å¤©å°±è€ƒè™‘åŒ…ä½“å¤§å°
âœ… æ¯æ¬¡æ„å»ºæ£€æŸ¥åŒ…ä½“æ˜¯å¦è¶…æ ‡
âœ… åœ¨çœŸæœºä¸Šæµ‹è¯•å†…å­˜å’Œæ€§èƒ½
âœ… å‡†å¤‡ä½ç”»è´¨é™çº§æ–¹æ¡ˆ
âœ… å®šæœŸæ¸…ç†æœªä½¿ç”¨èµ„æº
```

ä¸¤ä¸ªå¹³å°çš„æ€§èƒ½ä¼˜åŒ–é‡ç‚¹å®Œå…¨ä¸åŒï¼Œéœ€è¦æ ¹æ®ç›®æ ‡å¹³å°åˆ¶å®šä¸“é—¨çš„ä¼˜åŒ–ç­–ç•¥ï¼