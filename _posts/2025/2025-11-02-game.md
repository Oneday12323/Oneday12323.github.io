---
layout: articles
title: å¾®ä¿¡å°æ¸¸æˆæ„å»ºå…¨é“¾è·¯æ·±åº¦è§£æ
tags: 
article_header:
  type: cover
---

**ï¼ˆä» Cocos Creator åˆ° CDNï¼Œå†åˆ°æ¸¸æˆåŠ è½½è¿è¡Œï¼‰**

---

## å‰è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦äº†è§£â€œæ„å»ºå…¨é“¾è·¯â€ï¼Ÿ

å½“ä¸€ä¸ªå°æ¸¸æˆè¿›å…¥æ­£å¼è¿è¥åï¼Œä½ ä¼šé‡åˆ°è¿™äº›é—®é¢˜ï¼š

* **åŒ…ä½“æ€ä¹ˆå‹åˆ° 4MBï¼Ÿ**
* **èµ„æºæ€ä¹ˆæ‹†æˆ CDNï¼Ÿæ€ä¹ˆåœ¨è¿è¡Œæ—¶æ­£ç¡®åŠ è½½ï¼Ÿ**
* **å¼•æ“æ’ä»¶ vs è‡ªå¸¦å¼•æ“åˆ°åº•æ€ä¹ˆé€‰ï¼Ÿ**
* **æ„å»ºå‡ºæ¥çš„ import/native/config.json éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ**
* **ä» bundle.load å¼€å§‹èµ„æºåˆ°åº•æ€ä¹ˆæ‰¾åˆ°æœ€ç»ˆçš„ PNGï¼Ÿ**

è¿™ç¯‡æ–‡ç« ï¼Œå°±æ˜¯æŠŠæ•´ä¸ªæµç¨‹ä»ã€Œæ„å»º â†’ äºŒæ¬¡æ‰“åŒ… â†’ ä¸»åŒ… & è¿œç¨‹åŒ…æ‹†åˆ† â†’ è¿è¡ŒåŠ è½½ã€**å…¨éƒ¨è®²é€**ã€‚

---

# æ•´ä½“æµç¨‹ï¼šä¸€å¼ å›¾çœ‹æ˜ç™½

è¿™å¥—æ„å»ºé“¾è·¯åˆ†ä¸‰å¤§é˜¶æ®µï¼š

```
pnpm run pub-minigame-test05
        â”‚
        â–¼
Node æ„å»ºè„šæœ¬ cocos_build
        â”‚
        â–¼
Cocos Creator æ„å»ºå¼•æ“ + èµ„æº + bundles
        â”‚
        â–¼
Node äºŒæ¬¡åŠ å·¥ï¼šæ³¨å…¥ç¯å¢ƒã€ç‰ˆæœ¬ã€æ‹†è¿œç¨‹åŒ…ã€åˆ é™¤å¼•æ“
        â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ minigameFirst â†’ å¾®ä¿¡å°æ¸¸æˆä¸»åŒ…
   â””â”€â”€â”€â”€â”€â”€â”€â”€ build/yourproject â†’ CDN è¿œç¨‹èµ„æºåŒ…
```

**ä¸»åŒ…**ï¼šåªæ”¾æ¸¸æˆ JSã€é…ç½®ã€æå°‘é‡èµ„æº
**è¿œç¨‹åŒ…**ï¼šæ”¾å›¾é›†ã€å›¾ç‰‡ã€spineã€éŸ³é¢‘ï¼Œå…¨é‡èµ„æº

è¿è¡Œæ—¶ç”± `settings.js` çš„ `REMOTE_SERVER_ROOT` å†³å®šè®¿é—® CDNã€‚

---

# ç¬¬ä¸€æ­¥ï¼šNode å¦‚ä½•é©±åŠ¨ Cocos Creator æ„å»ºï¼Ÿ

å‘½ä»¤å…¥å£ï¼š

```
pnpm run pub-minigame-test
```

è‡ªåŠ¨è®¾ç½®ï¼š

* `COCOS_ENV=test`
* `PLATFORM=wechatgame`
* `whole=0`ï¼ˆè¿œç¨‹åŒ…æ¨¡å¼ï¼‰
* `enginePlugin=1`ï¼ˆä½¿ç”¨å¾®ä¿¡å¼•æ“æ’ä»¶ï¼‰
* `gameBuild=9999`ï¼ˆæ„å»ºå·ï¼‰

Node è„šæœ¬ä¸»è¦åšï¼š

### âœ” é€‰æ‹©æ„å»ºé…ç½® `mgc-game-test-cdn.json`

è¿™ä¸ªé…ç½®çš„ä½œç”¨ï¼š

* æ„å»ºç›®æ ‡ç›®å½•
* æ˜¯å¦ä½¿ç”¨è¿œç¨‹åŒ…
* CDN æ ¹è·¯å¾„
* è¿‡æ»¤æ¨¡å—ï¼ˆå‡å°‘ä½“ç§¯ï¼‰
* å‹ç¼©å›¾ç‰‡ã€åˆå›¾è®¾ç½®

### âœ” æ¸…ç†æ—§ç›®å½•ï¼ˆbuild/temp/libraryï¼‰

### âœ” è°ƒç”¨ Creator CLI æ‰§è¡ŒçœŸæ­£æ„å»º

```
CocosCreator --build platform=wechatgame;configPath=xxx.json
```

Creator ä¼šç”Ÿæˆï¼š

```
build/wechatgame/
```

å†…å«ï¼š

* game.js
* settings.js
* cocos ç›®å½•
* å„ç§ bundle
* remote ç›®å½•ï¼ˆå¦‚æœé…ç½®è¿œç¨‹ï¼‰

---

# ç¬¬äºŒæ­¥ï¼šCocos Creator å†…éƒ¨æ„å»ºåˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ

è¿™æ˜¯æœ€æ··ä¹±ä½†æœ€å…³é”®çš„é˜¶æ®µã€‚

### âœ” â‘  QuickCompiler ç¼–è¯‘è„šæœ¬ â†’ ç”Ÿæˆ game.js

### âœ” â‘¡ èµ„æºæ‰“åŒ…æˆå¤šä¸ª Bundle

æ¯ä¸ª Bundle ä¼šåŒ…å«ï¼š

```
import/    â† åºåˆ—åŒ–èµ„æºï¼ˆPrefabã€SpriteFrame
native/    â† çœŸå®æ–‡ä»¶ï¼ˆpng/jpg/mp3/skel/ttfï¼‰
config.xxx.json â† èµ„æºç´¢å¼•è¡¨ï¼ˆéå¸¸é‡è¦ï¼‰
```

ä¾‹å¦‚ï¼š

```
assets/main/
assets/internal/
assets/mainbundle/
remote/cardbundleres/
```

### âœ” â‘¢ auto-atlas è‡ªåŠ¨åˆå›¾

æ—¥å¿—é‡Œçš„å„ç§ warning éƒ½æ˜¯è¿™é‡ŒæŠ¥çš„ã€‚

### âœ” â‘£ settings.js è®°å½•ï¼š

* bundle ç‰ˆæœ¬å·ï¼ˆhashï¼‰
* è¿œç¨‹åŒ…åˆ—è¡¨
* CDN è·¯å¾„å ä½ç¬¦ï¼ˆå¾… Node æ›¿æ¢ï¼‰
* æ¸¸æˆå…¥å£åœºæ™¯

---

# ç¬¬ä¸‰æ­¥ï¼šNode äºŒæ¬¡åŠ å·¥ â€”â€” çœŸæ­£æ„å»ºäº§ç‰©çš„å…³é”®

Creator æ„å»ºå®Œåï¼ŒNode å†å¤„ç†ä¸€æ¬¡ã€‚

---

## âœ” 1ï¼‰å‘ game.js æ³¨å…¥ç¯å¢ƒå˜é‡

åŠ å…¥ï¼š

```
window.APP_ENV = 'test';
window.gameBuild = 9999;
window.ENGINE_PLUGIN_FLAG = 1;
```

ç”¨äºï¼š

* åŒºåˆ†æµ‹è¯•/çº¿ä¸Šé€»è¾‘
* ä¸ŠæŠ¥åŸ‹ç‚¹
* æ˜¯å¦å¯ç”¨å¼•æ“æ’ä»¶æµç¨‹

---

## âœ” 2ï¼‰å†™å…¥ CDN åœ°å€åˆ° settings.js

æŠŠæ„å»ºé…ç½®ä¸­çš„ï¼š

```
REMOTE_SERVER_ROOT = https://awp-assets.xxx.com/xxx
```

å†™åˆ° settings.js ä¸­ã€‚

è¿è¡Œæ—¶æ¯æ¬¡åŠ è½½èµ„æºéƒ½ä¼šæ‹¼ï¼š

```
CDN_ROOT + /remote/cardbundleres/import/xxxx.js
```

---

## âœ” 3ï¼‰å‹ç¼©æ‰€æœ‰ JSï¼ˆTerserï¼‰

å‡å°‘åŒ…ä½“ + æ·¡åŒ–æºç ã€‚

---

## âœ” 4ï¼‰æ‹†è¿œç¨‹åŒ…ï¼ˆwhole = 0ï¼‰

åˆ é™¤ï¼š

```
minigameFirst/remote
```

è¿œç¨‹èµ„æºåªä¿ç•™åœ¨ï¼š

```
build/wechatgame/remote
```

ç„¶åæ”¾ CDNã€‚

---

## âœ” 5ï¼‰å¼•æ“æ’ä»¶æ¨¡å¼ï¼ˆenginePlugin=1ï¼‰

åˆ é™¤ä¸»åŒ…å†…çš„ï¼š

```
minigameFirst/cocos
```

å°æ¸¸æˆç”¨å¾®ä¿¡å†…ç½®å¼•æ“ DLLï¼ŒåŒ…ä½“èŠ‚çœè¶…å¤§ç©ºé—´ã€‚

---

## âœ” 6ï¼‰ç”Ÿæˆæœ€ç»ˆäº§ç‰©

* **minigameFirst** â†’ ä¸Šä¼ å¾®ä¿¡
* **build/new2022/wechatgame** â†’ ä¸Šä¼  CDN
* è¿˜ä¼šç”Ÿæˆä¸€ä¸ªæ‰“åŒ…åçš„ ZIP â†’ ç”¨äºéƒ¨ç½²/å­˜æ¡£

---

# è¿è¡Œæ—¶ï¼šå°æ¸¸æˆå¯åŠ¨ & è¿œç¨‹èµ„æºåŠ è½½æµç¨‹

å¯åŠ¨é“¾è·¯å¦‚ä¸‹ï¼ˆè¶…çº§å…³é”®ï¼‰ï¼š

```
minigameFirst/game.js
        â†“
åŠ è½½ adapter / SDK / polyfill
        â†“
æ ¹æ® ENGINE_PLUGIN_FLAG åŠ è½½å¼•æ“ï¼š
    - 1 â†’ åŠ è½½å¾®ä¿¡ç‰ˆ Lamber
    - 0 â†’ åŠ è½½ Cocos2d-js-min.js
        â†“
launch()
        â†“
main.js / window.boot()
        â†“
cc.assetManager.init({
   server: REMOTE_SERVER_ROOT
})
        â†“
æŒ‰éœ€åŠ è½½ bundle â†’ import pack â†’ native æ–‡ä»¶
```

---

# import / native / config.json æ˜¯ä»€ä¹ˆï¼Ÿ

æ¯ä¸ªèµ„æº bundle è¾“å‡ºåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š

---

## import/

å­˜ **åºåˆ—åŒ–åçš„èµ„æºä¿¡æ¯**ï¼š

* Prefab JSON
* SpriteFrame JSON
* Texture2D çš„ meta æè¿°
* Spine çš„ meta æè¿°

æ ¼å¼ï¼š

```
import/0c/0c0ffec83.9b287.js
```

---

## native/

å­˜ **çœŸå®æ–‡ä»¶**ï¼š

* png/jpg
* skel/atlas
* mp3/wav
* fnt/ttf

ç¤ºä¾‹ï¼š

```
native/0.e7f1c.png
```

---

## config.xx.json

éå¸¸å…³é”®ï¼Œæ˜¯èµ„æºç´¢å¼•è¡¨ã€‚

åŒ…å«ï¼š

* pathsï¼šé€»è¾‘è·¯å¾„ â†’ ç±»å‹ + ç´¢å¼•
* typesï¼šèµ„æºç±»å‹æ•°ç»„
* uuidsï¼šæ‰€æœ‰èµ„æº uuid
* packsï¼šå“ªäº›æ–‡ä»¶æ‰“æˆä¸€ä¸ª import pack
* versions.importï¼špack â†’ hash
* versions.nativeï¼šnative æ–‡ä»¶ â†’ hash
* depsï¼šä¾èµ–å…¶ä»– bundle
* redirectï¼šèµ„æºå¤ç”¨

---

# èµ„æºé€†å‘åŠ è½½é“¾è·¯ï¼šä» bundle.load åˆ°å®é™… PNG æ–‡ä»¶

ä»¥ï¼š

```
bundle.load("prefabs/cardPanel")
```

ä¸ºä¾‹ï¼š

---

### â‘  ä» paths æŸ¥æ‰¾åˆ°ï¼š

```
"12": ["prefabs/cardPanel", 2]
```

ç´¢å¼• = 12ã€‚

---

### â‘¡ åœ¨ packs æŸ¥æ‰¾åŒ…å« 12 çš„ packï¼š

```
"0c0ffec83": [60,12,46,...]
```

---

### â‘¢ åœ¨ versions.import æŸ¥ pack çš„ hashï¼š

```
0c0ffec83 â†’ 9b287
```

---

### â‘£ æ„é€ ä¸‹è½½ URLï¼š

```
remote/cardbundleres/import/0c0ffec83.9b287.js
```

ä¸‹è½½ â†’ ååºåˆ—åŒ– â†’ å¾—åˆ° Prefabã€‚

---

# å¯¹å›¾ç‰‡ `img_banner`ï¼š

* Texture2D â†’ index 0 â†’ import æ–‡ä»¶ 01b8c105b.f1682.js
* SpriteFrame â†’ index 7 â†’ import æ–‡ä»¶ 0c0ffec83.9b287.js
* PNG â†’ index 0 â†’ native æ–‡ä»¶ 0.e7f1c.png

SpriteFrame åŠ è½½æ—¶å¼•æ“ä¼šè‡ªåŠ¨è”åŠ¨åŠ è½½ Texture2Dã€‚

---

# æœ€ç»ˆæ€»ç»“ï¼šè¿™æ˜¯ä¸€å¥—éå¸¸æˆç†Ÿçš„å°æ¸¸æˆç”Ÿäº§é“¾è·¯

**è¿™æ•´å¥— pipeline çš„ä¼˜ç‚¹ï¼š**

* åŒ…ä½“å°ï¼ˆå¼•æ“æ’ä»¶ + è¿œç¨‹åŒ…ï¼‰
* CDN åŠ é€Ÿ
* è§£è€¦æ„å»ºä¸éƒ¨ç½²
* Node åŠŸèƒ½å¼ºã€å¯ä»»æ„å®šåˆ¶
* Bundle ç²’åº¦æ¸…æ™°ï¼Œåˆ©äºèµ„æºæ²»ç†
* import/native/config.json æ¶æ„ä¾¿äºç¼“å­˜ç®¡ç†

**å¯ç»§ç»­ä¼˜åŒ–ï¼š**

* è‡ªåŠ¨èµ„æºä½“ç§¯åˆ†æï¼ˆimport/native å¤§å°æŠ¥å‘Šï¼‰
* CDN ç‰ˆæœ¬è‡ªåŠ¨åˆ·æ–°æµç¨‹
* åœ¨çº¿åˆ‡æ¢èµ„æºï¼ˆç°åº¦ï¼‰
* å›¾é›†åˆå¹¶ç­–ç•¥å¢å¼º
* ä½¿ç”¨ webp/avif é™ä½å›¾ç‰‡ä½“ç§¯




# ğŸ¯ å¾®ä¿¡å°æ¸¸æˆ Â· èµ„æºåŠ è½½å…¨é“¾è·¯å›¾

**ï¼ˆä»ä¸»åŒ…åˆ° CDNï¼Œå†ä» config.json åˆ° import/native æ–‡ä»¶ï¼‰**

ä¸‹é¢è¿™å¼ æµç¨‹å›¾æ­ç¤ºäº†æ•´ä¸ªé¡¹ç›®ä» **å¯åŠ¨ â†’ åŠ è½½å¼•æ“ â†’ åŠ è½½ bundle â†’ DL import/native â†’ ååºåˆ—åŒ–èµ„æº â†’ æ¸²æŸ“** çš„å…¨éƒ¨å†…éƒ¨é“¾è·¯ã€‚

---

## **ã€èµ„æºåŠ è½½é“¾è·¯æ€»å›¾ï¼ˆASCII å›¾ï¼‰ã€‘**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å¾®ä¿¡å°æ¸¸æˆåŠ è½½å…¥å£       â”‚
â”‚     ï¼ˆminigameFirst ä»£ç åŒ…ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
       ã€1ã€‘åŠ è½½ game.js
                â”‚
                â–¼
   æ³¨å…¥ APP_ENV / BUILD_VERSION / ENGINE_PLUGIN
                â”‚
                â–¼
        åˆ¤æ–­å¼•æ“æ’ä»¶æ˜¯å¦å¯ç”¨
          â”œâ”€ æ˜¯ â†’ åŠ è½½å¾®ä¿¡ Lamber å¼•æ“
          â””â”€ å¦ â†’ åŠ è½½ cocos2d-js-min.js
                â”‚
                â–¼
          è°ƒç”¨ launch() è¿›å…¥å¼•æ“å¯åŠ¨
                â”‚
                â–¼
      ã€2ã€‘æ‰§è¡Œ main.js / window.boot()
                â”‚
                â–¼
      cc.assetManager.init({
          server: REMOTE_SERVER_ROOT   â† CDN æ ¹è·¯å¾„
      })
                â”‚
                â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”ã€èµ„æºåŠ è½½é˜¶æ®µå¼€å§‹ã€‘â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                â”‚
                â–¼
       bundle.load("xxx", Type)
                â”‚
                â–¼
ã€3ã€‘æ ¹æ® bundleVers â†’ ä¸‹è½½ bundle çš„ config.hash.json
          ï¼ˆä¾‹å¦‚ï¼šremote/bagbundleres/config.6e88d.jsonï¼‰
                â”‚
                â–¼
ã€4ã€‘åœ¨ config.json ä¸­æŸ¥æ‰¾èµ„æºè·¯å¾„ï¼š
      - paths[] â†’ æ‰¾åˆ°èµ„æºç´¢å¼• index
      - types[] â†’ èµ„æºç±»å‹æ˜ å°„
      - redirect[] â†’ æ£€æŸ¥é‡å®šå‘
      - uuids[] â†’ è·å–èµ„æº uuid
                â”‚
                â–¼
ã€5ã€‘åœ¨ packs ä¸­æŸ¥èµ„æºå±äºå“ªä¸ª import packï¼š
      packs: { "0c0ffec83": [12,60,...] }
                â”‚
                â–¼
ã€6ã€‘åœ¨ versions.import ä¸­æŸ¥ pack çš„ hashï¼š
      "0c0ffec83" â†’ "9b287"
                â”‚
                â–¼
ã€7ã€‘æ‹¼å‡º import æ–‡ä»¶ URLï¼š
   remote/bagbundleres/import/0c0ffec83.9b287.js
                â”‚
                â–¼
      ä¸‹è½½ import pack â†’ åºåˆ—åŒ– JSON
                â”‚
                â–¼
ã€8ã€‘è§£æ import JSON â†’ å¾—åˆ°èµ„æºä¿¡æ¯
   - Prefab JSON
   - SpriteFrame JSON
   - Texture2D meta
                â”‚
                â–¼
ï¼ˆå¦‚æœ‰å›¾ç‰‡ / éŸ³é¢‘ä¾èµ–ï¼‰
ã€9ã€‘æŸ¥ versions.native å¾—åˆ° native æ–‡ä»¶ hashï¼š
   index 0 â†’ "e7f1c"
                â”‚
                â–¼
ã€10ã€‘æ‹¼å‡º native æ–‡ä»¶ URLï¼š
   remote/bagbundleres/native/0.e7f1c.png
                â”‚
                â–¼
   ä¸‹è½½ PNG / JPG / MP3 / skel / atlas ç­‰
                â”‚
                â–¼
ã€11ã€‘æ„å»ºå®Œæ•´èµ„æºï¼š
   - Texture2D + åƒç´ 
   - SpriteFrame rect/pivot
   - Prefab èŠ‚ç‚¹æ ‘
                â”‚
                â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”ã€æ¸²æŸ“é˜¶æ®µå¼€å§‹ã€‘â”â”â”â”â”â”â”â”â”â”â”â”â”â”
                â”‚
                â–¼
ã€12ã€‘å¼•æ“å°†èµ„æºäº¤ç»™æ¸²æŸ“ç®¡çº¿ â†’ GPU æ¸²æŸ“ç”»é¢
```

---

# é…åˆç¤ºä¾‹ï¼š`prefabs/bagPanel` åŠ è½½é“¾è·¯

```
prefabs/bagPanel
      â”‚
      â–¼
paths æ‰¾åˆ° index = 12
      â”‚
packs æ‰¾åˆ° pack = 0c0ffec83
      â”‚
versions.import å¾—åˆ° hash = 9b287
      â”‚
æ‹¼ URL:
remote/bagbundleres/import/0c0ffec83.9b287.js
      â”‚
è§£æ import â†’ Prefab JSON
      â”‚
Prefab ä¾èµ–çš„ SpriteFrame â†’ Texture2D
      â”‚
Texture2D index = 0 â†’ native hash = e7f1c
      â”‚
æ‹¼ URL:
remote/bagbundleres/native/0.e7f1c.png
      â”‚
åŠ è½½ PNG â†’ æ„å»º Texture â†’ å¡«åˆ° SpriteFrame
      â”‚
Prefab ååºåˆ—åŒ– â†’ åœºæ™¯æ¸²æŸ“
```

---

# é…åˆç¤ºä¾‹ï¼š`images/banner_rukou` åŠ è½½é“¾è·¯

* SpriteFrame â†’ index 7 â†’ import æ–‡ä»¶ 0c0ffec83.9b287.js
* Texture2D â†’ index 0 â†’ import æ–‡ä»¶ 01b8c105b.f1682.js
* PNG æ–‡ä»¶ â†’ index 0 â†’ native æ–‡ä»¶ 0.e7f1c.png

å¼•æ“ä¼šè‡ªåŠ¨é¡ºä¾¿åŠ è½½ Texture2Dï¼Œç„¶ååˆæˆ SpriteFrameã€‚
