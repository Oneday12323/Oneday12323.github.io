

# 小游戏分包与 AssetBundle 全解析：为什么分包能让启动更快？

在小游戏项目中，**启动速度（FCP = First Contentful Paint）** 是影响用户留存的关键指标。首包越大，下载时间越长，用户能看到画面的时间就越慢。为了提升体验，主流小游戏平台都支持 **分包机制（Subpackage）**，而在 Cocos Creator 体系下，官方推荐使用 **AssetBundle** 来实现资源模块化与按需加载。

这篇文章将带你系统理解：**为什么要分包、AssetBundle 的作用是什么、构建过程中具体做了什么、它能带来哪些收益。**

---

# 1. 为什么小游戏要做分包？

小游戏启动过程本质上就是：

> 下载主包 → 加载代码 → 加载基础资源 → 初始化 → 展示首屏

如果主包太大，则会导致：

* 首屏延迟，FCP 变慢
* 启动时间长，用户容易流失
* 审核有风险（如微信主包限制 20MB）

因此，核心目标是：

> **首包能有多小，就让它多小；非首屏资源不必在启动时加载。**

也正因如此，Cocos 提供了一套资源模块化机制：**AssetBundle**。

---

# 2. 什么是 AssetBundle？为什么它是分包最佳实践？

AssetBundle 允许开发者将贴图、脚本、Prefab、场景等资源按模块拆分成多个 bundle，实现：

## 2.1 启动更快：减少首屏加载资源

把非首屏资源拆分出去，只加载必要部分，直接减少：

* 启动脚本体积
* 启动要加载的贴图、Prefab、场景
* 启动时的网络下载量和解压量

**FCP 变得更快。**

---

## 2.2 包体更小：降低审核风险

小游戏平台通常限制主包体积（如微信 ≤ 20MB）。大量资源由分包拉取，就能让主包更轻盈，不会因为贴图、音频太多而超限。

---

## 2.3 每个 bundle 具备完整性、独立性、复用性

例如结构：

* lobby（大厅）
* battle（战斗）
* level_1（关卡1）
* level_2（关卡2）

每个 bundle 可独立：

* **加载**（按需加载）
* **卸载**（释放内存）
* **复用**（多个模块引用同一 bundle）

让资源管理更灵活、内存占用更低。

---

# 3. AssetBundle 构建阶段到底做了什么？

当你在 Cocos 中把某个文件夹设置为 AssetBundle，构建器会对目录中的 **代码**、**资源** 和 **资源配置** 进行三类处理。

---

## 3.1 代码处理：合成独立的 index.js / game.js

Bundle 文件夹下的所有脚本（TS/JS）会：

1. 根据平台（微信/字节/QQ/H5…）合并成一个入口脚本

   * 可能是：`index.js` 或 `game.js`
2. 从主包中删除，减少主包体积

保证该 bundle **自身就能运行，不依赖主包代码**。

---

## 3.2 资源处理：所有资源统一进入 import/native

Bundle 文件夹中的所有资源 **以及它们依赖的外部资源** 会被整体处理：

* 放入 `import/`（序列化资源，如 prefab/json/anim）
* 放入 `native/`（原生资源，如 png/jpg/mp3/ttf）

构建器还会自动补齐依赖，例如：

> A.prefab 引用 B.png
> 即使 B.png 不在该 bundle 文件夹，也会自动加入 bundle。

这样确保 bundle 的 **完整性**。

---

## 3.3 config.json：记录 bundle 的所有资源信息

每个 bundle 会生成一个 `config.json`，里面包含：

* 资源路径
* 资源类型（texture、prefab、audio…）
* 版本号/MD5
* 引用关系
* 资源 UUID 与实际文件位置的映射

加载 bundle 时，运行时会依赖这个配置构建资源加载索引。

---

# 4. 整体构建流程示意图

```
[Bundle Folder]
   |-- scripts/
   |-- textures/
   |-- scenes/
   |-- dependencies（自动补齐）

        ↓ 构建器 AssetBundle Pipeline

【代码合并】   →  index.js / game.js
【资源打包】   →  import/ + native/
【索引配置】   →  config.json
```

最终生成一个：
**可按需下载、可独立加载、可独立卸载的 bundle 包。**

---

# 5. 实际收益：分包到底能带来多大提升？

| 优化类型              | 效果范围                      |
| ----------------- | ------------------------- |
| 代码体积减少            | 主包脚本减少 20–60%（视项目规模）      |
| 贴图等资源拆分           | 启动加载资源大幅减少                |
| Prefab/Scene 延后加载 | 非首屏内容完全不在启动阶段加载           |
| 首屏 FCP 提升      | **200ms–1500ms+**（真实项目常见） |

收益取决于你的项目资源结构、bundle 划分方式与首屏需求。

---

# 总结

AssetBundle 是小游戏分包的核心工具，它在 **启动速度、包体大小、内存占用、资源复用性** 等方面都能带来显著收益。

它通过构建阶段的：

* **代码合并与剥离**
* **资源依赖分析与独立打包**
* **config.json 索引构建**

最终实现一套高效、可扩展、可按需加载的模块化资源体系。