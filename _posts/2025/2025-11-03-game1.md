# AssetBundle 加载策略与启动性能对比：预加载 vs 并行加载 vs 按需拉取

上一篇博客，我们讲到了为什么小游戏需要分包以及 AssetBundle 在构建阶段做了什么。这一次，我们把重点放在**运行时加载策略**，因为构建好分包只是第一步，真正影响玩家体验的是：

> ◆ 什么时候加载
> ◆ 哪些资源要预加载
> ◆ 如何避免加载卡顿
> ◆ 如何缩短 FCP

## 1. AssetBundle 有三种常用加载策略

### ✔ Strategy A：预加载（Preload）

适用于**首屏必要模块**。

```
bundle.load('scene/home')
```

特点：

* 保证首屏必定可用
* 避免切换时等待加载
* 用户体验最佳

缺点：

* 会增加启动阶段的加载压力
* 加载速度受网络/磁盘 IO 影响

非常适合以下 bundle：

```
lobby
common UI
game core
```

---

### ✔ Strategy B：按需加载（Lazy Load）

适用于**二级场景 & 功能模块**。

```
button.onClick(() => {
  assetManager.loadBundle('battle_bundle')
})
```

优点：

* 启动最轻量，首屏最快
* 不会为未使用场景浪费下载带宽与内存

缺点：

* 第一次进入模块时可能卡顿
* 需要谨慎处理资源依赖

典型例子：

```
battle (战斗模块)
level_x
tutorial
```

---

### ✔ Strategy C：并行加载（Parallel Load）

适用于启动后后台进行。

```js
preloadBundle('battle');
preloadBundle('room');
```

特点：

* 首屏出来后继续加载其他 bundle
* 不影响用户的启动体验

非常适合：

* 关卡资源
* 复杂 UI
* 大厅后续入口

同时可结合分时加载（yield）减少主线程压力。

---

## 2. 实战推荐（最佳组合）

最常见、也最靠谱的方案：

| 模块类型    | 推荐策略 |
| ------- | ---- |
| 首屏必需资源  | 预加载  |
| 大模块     | 并行加载 |
| 测试/特殊场景 | 按需加载 |

示例架构：

```
[启动阶段] ↓
common_bundle 预加载

[首屏渲染后] ↓
battle_bundle 并行加载

[用户点击战斗] ↓
level_bundle 按需加载
```

这样可以做到：

* FCP 最快
* 主包最小
* 所有模块仍然可快速使用

---

# 3. 分包 vs 不分包：启动性能对比

先给一个典型小游戏常见启动耗时拆解：

### ❌ 不使用分包

所有资源都会在启动阶段加载：

```
代码加载：1500ms
资源加载：2000ms
场景初始化：800ms
渲染首屏：300ms
---------------------
首屏总耗时：≈ 4600ms
```

启动阶段高达 4.6 秒，极其影响体验。

---

### ✅ 使用分包

只加载 core + 首屏资源：

```
主包（核心启动）: 800ms
预加载+并行资源: 1200ms
首屏初始化: 300ms
---------------------
首屏总耗时：≈ 1100–1800ms
```

也就是说，整体提升非常明显。

---

## 对比图（可直接放文章里）

### 启动阶段加载耗时对比

```
不使用分包
╔══════════════════════╗
║     下载/加载资源     ║ 4–5s
╚══════════════════════╝

使用分包
╔════════╗
║  核心启动 ║ 1–1.8s
╚════════╝  + 其他 bundle 异步加载
```

### 资源体积对比

```
不使用分包 = 20–60MB 全部进主包
使用分包 = 主包 5–10MB + bundle 分阶段下载
```

---

# 4. 为什么性能差距可以这么大？

原因非常直观：

* 分包直接减少首屏阶段资源量
* 并行加载避免资源全部挤在启动阶段
* 资源不会在启动时解压或解析
* 大型场景不需要首屏初始化

换句话说：

> 分包不是可选优化，是高体验小游戏的“必要条件”。

---

# 5. 最终结论

AssetBundle + 正确加载策略，可以让游戏：

* 首屏时间优化 2–4 倍
* 主包体积减小 30–70%
* 内存更低、更可控
* 架构清晰可维护

推荐组合：

| 模块      | 策略   |
| ------- | ---- |
| 核心模块    | 预加载  |
| 常用模块    | 并行加载 |
| 关卡/稀用模块 | 按需加载 |
