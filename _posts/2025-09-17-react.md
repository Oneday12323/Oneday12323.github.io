---
title: React é¡¹ç›®ä»æ‰“åŒ…åˆ°ç”¨æˆ·è®¿é—®çš„å®Œæ•´æµç¨‹
tags: React Webpack æ‰“åŒ… éƒ¨ç½² CDN ç¼“å­˜
article_header:
  type: cover
---
# React é¡¹ç›®ä»æ‰“åŒ…åˆ°ç”¨æˆ·è®¿é—®çš„å®Œæ•´æµç¨‹

## ä¸€ã€æµæ°´çº¿è§¦å‘é˜¶æ®µ

```
å¼€å‘è€…æäº¤ä»£ç  â†’ Git Push â†’ è§¦å‘ CI/CD æµæ°´çº¿
```

å…¸å‹çš„è§¦å‘æ¡ä»¶ï¼š
- Push åˆ°ç‰¹å®šåˆ†æ”¯ï¼ˆå¦‚ `main`ã€`release`ï¼‰
- åˆ›å»º Pull Request
- æ‰‹åŠ¨è§¦å‘æ„å»º
ä¸€èˆ¬æ¥è¯´ï¼Œæ›´æ–°äº†ä»£ç ä¹‹åä¼šè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæµ‹è¯•é€šè¿‡åæ‰ä¼šç»§ç»­åç»­çš„æ„å»ºå’Œéƒ¨ç½²æµç¨‹ã€‚

## äºŒã€æ„å»ºç¯å¢ƒå‡†å¤‡ï¼ˆtalosæ‰“åŒ…å·¥å…·å¯ä»¥é…ç½®å…·ä½“çš„å‘½ä»¤ï¼‰

```bash
# 1. æ‹‰å–ä»£ç 
git clone/pull

# 2. å®‰è£…ä¾èµ–
npm install  # æˆ– yarn install

# 3. è¯»å–ç¯å¢ƒå˜é‡
export APP_ENV=production
export APP_API_HOST=https://api.example.com
export PUBLIC_URL=/
```

## ä¸‰ã€Webpack æ‰“åŒ…æµç¨‹

### 1. **åˆå§‹åŒ–é˜¶æ®µ**
```
è¯»å– a.config.js ï¼ˆåŒ…å«äº†webpackç›¸å…³çš„é…ç½®ï¼‰
    â†“
è§£æ configureWebpack é…ç½®
    â†“
åˆå§‹åŒ– Webpack Compiler
```

### 2. **ç¼–è¯‘é˜¶æ®µ**

#### **å…¥å£å¤„ç†**
```javascript
// Webpack ä»å…¥å£æ–‡ä»¶å¼€å§‹
src/index.js (entry)
    â†“
import App from './App'
import './styles.css'
```

#### **æ¨¡å—è§£æ** (resolve é…ç½®ç”Ÿæ•ˆ)
```javascript
// é‡åˆ° import è¯­å¥
import { api } from '@/utils/api'

// Webpack æ ¹æ® resolve.alias è§£æ
'@' â†’ path.resolve(__dirname, 'src')
// å®é™…è·¯å¾„ï¼šsrc/utils/api.js

// æ ¹æ® resolve.extensions è‡ªåŠ¨è¡¥å…¨
api â†’ api.js â†’ api.jsx â†’ api.ts â†’ api.tsx
```

#### **ä»£ç è½¬è¯‘**
```javascript
// 1. TypeScript/JSX è½¬è¯‘
<App /> â†’ React.createElement(App, null)

// 2. ES6+ è½¬ ES5 (transpileDependencies é…ç½®çš„æ¨¡å—)
const foo = () => {} â†’ var foo = function() {}

// 3. CSS å¤„ç†
.box { width: 375px; }
    â†“ (viewport æ’ä»¶)
.box { width: 50vw; }  // 375/750 * 100
```

#### **ä¾èµ–å›¾æ„å»º**
```
index.js
  â”œâ”€ App.jsx
  â”‚   â”œâ”€ Header.jsx
  â”‚   â”œâ”€ Content.jsx
  â”‚   â””â”€ styles.css
  â”œâ”€ react (node_modules)
  â”œâ”€ axios (node_modules)
  â””â”€ zustand (node_modules)
```

### 3. **ä¼˜åŒ–é˜¶æ®µ** (optimization é…ç½®)

#### **ä»£ç åˆ†å‰²** (splitChunks)
```javascript
optimization: {
  splitChunks: {
    chunks: 'all',
    name: false,
  }
}
```

**è‡ªåŠ¨æ‹†åˆ†ç»“æœï¼š**
```
æ‰“åŒ…å‰ï¼š
  - æ‰€æœ‰ä»£ç åœ¨ä¸€èµ· (2MB)

æ‰“åŒ…åï¼š
  - main.[contenthash].js        (ä¸šåŠ¡ä»£ç  200KB)
  - vendors-node_modules.[hash].js  (ç¬¬ä¸‰æ–¹åº“ 1.5MB)
  - runtime-main.[hash].js       (Webpack runtime 10KB)
  - 0.[hash].chunk.js           (å¼‚æ­¥åŠ è½½çš„ç»„ä»¶)
```

#### **ä»£ç å‹ç¼©** (TerserPlugin)
```javascript
// å‹ç¼©å‰
function calculateTotal(items) {
  const total = items.reduce((sum, item) => {
    return sum + item.price;
  }, 0);
  return total;
}

// å‹ç¼©å
function a(b){return b.reduce((c,d)=>c+d.price,0)}
```

#### **æ–‡ä»¶å“ˆå¸Œ** (contenthash)
```javascript
output: {
  filename: '[name].[contenthash:8].js'
}

// ç”Ÿæˆç»“æœï¼š
main.a1b2c3d4.js
vendors.e5f6g7h8.js

// æ–‡ä»¶å†…å®¹æ”¹å˜ â†’ å“ˆå¸Œæ”¹å˜ â†’ æµè§ˆå™¨é‡æ–°ä¸‹è½½
// æ–‡ä»¶å†…å®¹ä¸å˜ â†’ å“ˆå¸Œä¸å˜ â†’ æµè§ˆå™¨ä½¿ç”¨ç¼“å­˜
```

### 4. **èµ„æºç”Ÿæˆé˜¶æ®µ**

#### **HtmlWebpackPlugin ç”Ÿæˆ HTML**
```html
<!-- public/index.html (æ¨¡æ¿) -->
<!DOCTYPE html>
<html>
<head>
  <title>My App</title>
</head>
<body>
  <div id="root"></div>
</body>
</html>

<!-- â†“ æ„å»ºå â†“ -->

<!DOCTYPE html>
<html>
<head>
  <title>My App</title>
  <link href="/static/css/main.a1b2c3d4.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>
  <script src="/static/js/runtime-main.e5f6g7h8.js"></script>
  <script src="/static/js/vendors.i9j0k1l2.js"></script>
  <script src="/static/js/main.a1b2c3d4.js"></script>
</body>
</html>
```

### 5. **è¾“å‡ºç›®å½•ç»“æ„**
```
dist/
â”œâ”€â”€ index.html
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ main.a1b2c3d4.js           (ä¸šåŠ¡ä»£ç )
â”‚   â”‚   â”œâ”€â”€ runtime-main.e5f6g7h8.js   (webpack runtime)
â”‚   â”‚   â”œâ”€â”€ vendors-node_modules.i9j0k1l2.js  (ç¬¬ä¸‰æ–¹åº“)
â”‚   â”‚   â””â”€â”€ 0.m3n4o5p6.chunk.js        (å¼‚æ­¥ç»„ä»¶)
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ main.a1b2c3d4.css
â”‚   â””â”€â”€ media/
â”‚       â””â”€â”€ logo.q7r8s9t0.png
```

## å››ã€éƒ¨ç½²é˜¶æ®µ

### 1. **ä¸Šä¼ åˆ°æœåŠ¡å™¨/CDN**
```bash
# æµæ°´çº¿æ‰§è¡Œéƒ¨ç½²å‘½ä»¤
aws s3 sync dist/ s3://my-bucket/  # ä¸Šä¼ åˆ° AWS S3
# æˆ–
scp -r dist/* user@server:/var/www/html/  # ä¸Šä¼ åˆ°è‡ªæœ‰æœåŠ¡å™¨
```

### 2. **CDN é…ç½®**
```
é™æ€èµ„æº (JS/CSS/å›¾ç‰‡) â†’ CDN
    â†“
é…ç½®ç¼“å­˜ç­–ç•¥ï¼š
  - HTML: Cache-Control: no-cache (å§‹ç»ˆéªŒè¯)
  - JS/CSS: Cache-Control: max-age=31536000 (1å¹´ï¼Œå› ä¸ºæœ‰ hash)
```

### 3. **Nginx é…ç½®** (é’ˆå¯¹ SPA)
```nginx
server {
  listen 80;
  server_name example.com;
  root /var/www/html;

  location / {
    try_files $uri $uri/ /index.html;  # historyApiFallback
  }

  # API ä»£ç† (ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œå¯¹åº”å¼€å‘ç¯å¢ƒçš„ devServer.proxy)
  location /servertreeapi/ {
    proxy_pass http://api-server:8080;
    proxy_set_header Host $host;
  }

  # é™æ€èµ„æºç¼“å­˜
  location /static/ {
    expires 1y;
    add_header Cache-Control "public, immutable";
  }
}
```

## äº”ã€ç”¨æˆ·è®¿é—®æµç¨‹

### 1. **é¦–æ¬¡è®¿é—®**
```
ç”¨æˆ·è¾“å…¥ URL: https://example.com
    â†“
DNS è§£æ â†’ æœåŠ¡å™¨ IP
    â†“
è¯·æ±‚ index.html (ä»æœåŠ¡å™¨)
    â†“
è§£æ HTMLï¼Œå‘ç°èµ„æºæ ‡ç­¾
    â†“
å¹¶è¡Œä¸‹è½½ï¼š
  - runtime-main.e5f6g7h8.js (ä» CDN)
  - vendors.i9j0k1l2.js (ä» CDN)
  - main.a1b2c3d4.js (ä» CDN)
  - main.a1b2c3d4.css (ä» CDN)
    â†“
æ‰§è¡Œ JSï¼š
  1. Webpack runtime åˆå§‹åŒ–
  2. åŠ è½½ React å’Œç¬¬ä¸‰æ–¹åº“
  3. æ‰§è¡Œä¸šåŠ¡ä»£ç 
  4. ReactDOM.render(<App />, document.getElementById('root'))
    â†“
æ¸²æŸ“é¡µé¢ï¼Œç”¨æˆ·çœ‹åˆ°å†…å®¹
```

### 2. **ç¬¬äºŒæ¬¡è®¿é—®** (ç¼“å­˜ç”Ÿæ•ˆ)
```
ç”¨æˆ·å†æ¬¡è®¿é—® https://example.com
    â†“
è¯·æ±‚ index.html (304 Not Modified æˆ–é‡æ–°ä¸‹è½½ï¼Œå› ä¸º no-cache)
    â†“
æ£€æŸ¥èµ„æºï¼š
  - runtime-main.e5f6g7h8.js â†’ æ–‡ä»¶åæœªå˜ â†’ ä½¿ç”¨ç¼“å­˜ âœ…
  - vendors.i9j0k1l2.js â†’ ä½¿ç”¨ç¼“å­˜ âœ…
  - main.a1b2c3d4.js â†’ ä½¿ç”¨ç¼“å­˜ âœ…
    â†“
é¡µé¢ç§’å¼€ï¼åªä¸‹è½½äº† HTML (å‡  KB)
```

### 3. **ä»£ç æ›´æ–°å** (contenthash ä½œç”¨)
```
å¼€å‘è€…ä¿®æ”¹äº†ä¸šåŠ¡ä»£ç å¹¶éƒ¨ç½²
    â†“
æ–°çš„æ„å»ºäº§ç‰©ï¼š
  - main.z9y8x7w6.js (æ–° hash)  â† æ”¹å˜äº†
  - vendors.i9j0k1l2.js (hash ä¸å˜)  â† æœªæ”¹å˜
  - runtime-main.v5u4t3s2.js (æ–° hash)  â† å› ä¸ºåŒ…å«äº†æ–°çš„ chunk ä¿¡æ¯
    â†“
ç”¨æˆ·è®¿é—®ï¼š
  - ä¸‹è½½æ–°çš„ index.html
  - ä¸‹è½½ main.z9y8x7w6.js (æ–°æ–‡ä»¶)
  - ä¸‹è½½ runtime-main.v5u4t3s2.js (æ–°æ–‡ä»¶)
  - ä½¿ç”¨ç¼“å­˜ vendors.i9j0k1l2.js (hash æœªå˜) âœ…
    â†“
åªä¸‹è½½äº†å˜åŒ–çš„æ–‡ä»¶ï¼ŒèŠ‚çœæµé‡å’Œæ—¶é—´
```

## å…­ã€ç‰¹æ®Šåœºæ™¯å¤„ç†

### 1. **æŒ‰éœ€åŠ è½½** (Code Splitting)
```javascript
// ä»£ç ä¸­ä½¿ç”¨åŠ¨æ€ import
const LazyComponent = React.lazy(() => import('./LazyComponent'));

// ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶
ä¸‹è½½ï¼šmain.js, vendors.js, runtime.js
    â†“
ç”¨æˆ·ç‚¹å‡»æŸä¸ªæŒ‰é’®ï¼Œè§¦å‘ LazyComponent
    â†“
åŠ¨æ€ä¸‹è½½ï¼š0.m3n4o5p6.chunk.js
    â†“
æ¸²æŸ“ LazyComponent
```

### 2. **API è¯·æ±‚** (devServer.proxy å¯¹åº”çš„ç”Ÿäº§é…ç½®)
```javascript
// å¼€å‘ç¯å¢ƒ
axios.get('/servertreeapi/user')
    â†“
devServer.proxy è½¬å‘åˆ° process.env.APP_API_HOST

// ç”Ÿäº§ç¯å¢ƒ
axios.get('/servertreeapi/user')
    â†“
Nginx é…ç½®çš„ proxy_pass è½¬å‘åˆ°å®é™… API æœåŠ¡å™¨
```

### 3. **è·¯ç”±è·³è½¬** (historyApiFallback)
```
ç”¨æˆ·è®¿é—®ï¼šhttps://example.com/about
    â†“
Nginx çš„ try_files é…ç½®ï¼š
  1. æŸ¥æ‰¾ /about æ–‡ä»¶ â†’ ä¸å­˜åœ¨
  2. æŸ¥æ‰¾ /about/ ç›®å½• â†’ ä¸å­˜åœ¨
  3. è¿”å› /index.html âœ…
    â†“
React Router æ¥ç®¡è·¯ç”±ï¼Œæ¸²æŸ“ About ç»„ä»¶
```

## ä¸ƒã€å®Œæ•´æ—¶é—´çº¿æ€»ç»“

```
T+0s    : å¼€å‘è€… git push
T+10s   : CI/CD æµæ°´çº¿å¯åŠ¨
T+20s   : npm install å®Œæˆ
T+30s   : Webpack å¼€å§‹ç¼–è¯‘
T+120s  : æ‰“åŒ…å®Œæˆï¼Œç”Ÿæˆ dist/ ç›®å½•
T+130s  : ä¸Šä¼ åˆ°æœåŠ¡å™¨/CDN
T+140s  : éƒ¨ç½²å®Œæˆï¼Œæ–°ç‰ˆæœ¬ä¸Šçº¿

ç”¨æˆ·è®¿é—®ï¼š
T+0ms   : ç”¨æˆ·è¾“å…¥ URL
T+50ms  : DNS è§£æå®Œæˆ
T+200ms : HTML ä¸‹è½½å®Œæˆ
T+500ms : JS/CSS ä¸‹è½½å®Œæˆ
T+800ms : React æ¸²æŸ“å®Œæˆ
T+1000ms: ç”¨æˆ·çœ‹åˆ°é¡µé¢ ğŸ‰
```

è¿™å°±æ˜¯ä»ä»£ç æäº¤åˆ°ç”¨æˆ·çœ‹åˆ°é¡µé¢çš„å®Œæ•´æµç¨‹ã€‚æ¯ä¸ªç¯èŠ‚éƒ½æœ‰å¯¹åº”çš„ä¼˜åŒ–ç‚¹ï¼Œæ¯”å¦‚ç¼“å­˜ç­–ç•¥ã€ä»£ç åˆ†å‰²ã€CDN åŠ é€Ÿç­‰ã€‚