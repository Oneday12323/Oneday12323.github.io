---
title: Webpack 配置详解
tags: Webpack 配置 优化 性能 代码分割
article_header:
  type: cover
---

## 基础配置

### `publicPath`
- **含义**：资源的公共路径前缀
- **作用**：决定所有静态资源（JS、CSS、图片等）的引用路径

### `devServer` **[Webpack DevServer]**
开发服务器配置：

- **`proxy`**：API 代理配置，转发请求到后端服务器
- **`hot: true`**：启用热模块替换（HMR）**[Webpack 5 默认优化]**
- **`historyApiFallback`**：支持 HTML5 History API 路由
- **`setupMiddlewares`** **[Webpack 5 新 API]**：自定义中间件（替代 Webpack 4 的 `before/after`）

## Webpack 核心配置（`configureWebpack`）

### 1. **`devtool`** **[Webpack 5 优化]**
```javascript
devtool: isEnvDevelopment ? 'cheap-module-source-map' : false
```
- **开发环境**：`cheap-module-source-map` - 较快的源码映射
- **生产环境**：`false` - 不生成 source map

### 2. **`output`** **[Webpack 5 增强]**
```javascript
output: {
  filename: '[name].[contenthash:8].js',  // [contenthash] 是 Webpack 5 推荐
  chunkFilename: '[name].[contenthash:8].chunk.js'
}
```
- **`contenthash`** **[Webpack 5 改进]**：基于文件内容的哈希，更好的缓存控制
- **命名模板**：`[name]`（chunk名）、`[contenthash:8]`（8位内容哈希）

### 3. **`resolve`**
路径解析配置：

```javascript
resolve: {
  extensions: ['.js', '.jsx', '.ts', '.tsx'],  // 自动解析扩展名
  alias: {  // 路径别名
    '@': path.resolve(__dirname, 'src')
  },
  fallback: {  // [Webpack 5 新增] Node.js 核心模块 polyfill
    path: require.resolve('path-browserify'),
    buffer: require.resolve('buffer/')
  }
}
```

**`fallback`** **[Webpack 5 特性]**：Webpack 5 不再自动 polyfill Node.js 核心模块，需手动配置

### 4. **`plugins`**

#### **HtmlWebpackPlugin**
```javascript
new HtmlWebpackPlugin({
  template: './public/index.html',
  inject: true,  // 自动注入资源
  minify: { ... }  // 生产环境压缩 HTML
})
```

#### **webpack.ProvidePlugin**
```javascript
new webpack.ProvidePlugin({
  Buffer: ['buffer', 'Buffer'],  // 全局提供 Buffer
  React: 'react'  // 自动导入 React
})
```

#### **HotModuleReplacementPlugin** **[Webpack 5 内置]**
- Webpack 5 中 HMR 已内置，`devServer.hot: true` 时自动启用
- 显式使用此插件是为了兼容性

#### **React Refresh Plugin**
- 开发环境的 React 快速刷新插件

### 5. **`optimization`** **[Webpack 5 核心优化]**

#### **`minimize` 和 `minimizer`**
```javascript
optimization: {
  minimize: !isEnvDevelopment,
  minimizer: [
    new TerserPlugin({
      terserOptions: {
        compress: { ecma: 5 },  // ES5 压缩
        mangle: { safari10: true },  // 混淆变量名
        output: { ascii_only: true }  // 转义非 ASCII 字符
      }
    })
  ]
}
```
- **TerserPlugin** **[Webpack 5 默认]**：代码压缩和混淆

#### **`splitChunks`** **[Webpack 5 优化]**
```javascript
splitChunks: {
  chunks: 'all',  // 所有类型的 chunk 都优化
  name: false  // 不自动生成 chunk 名称
}
```
- **作用**：自动分割代码，提取公共模块
- **Webpack 5 改进**：更智能的默认配置

#### **`runtimeChunk`** **[Webpack 5 推荐]**
```javascript
runtimeChunk: {
  name: (entrypoint) => `runtime-${entrypoint.name}`
}
```
- **作用**：将 webpack runtime 代码单独提取
- **好处**：长期缓存优化，runtime 变化不影响业务代码

## Webpack 5 特有/改进的特性总结

| 特性 | 说明 |
|------|------|
| **`contenthash`** | 更精确的内容哈希算法 |
| **`resolve.fallback`** | 手动配置 Node.js polyfill（不再自动） |
| **`setupMiddlewares`** | 新的 DevServer 中间件 API |
| **`optimization.splitChunks`** | 更智能的默认分包策略 |
| **`devtool` 优化** | 更快的 source map 生成 |
| **内置 Terser** | 默认使用 Terser 压缩 |
| **持久化缓存** | 虽未显式配置，但 Webpack 5 支持文件系统缓存 |

## 自定义框架配置（非 Webpack）

```javascript
pluginOptions: {
  stone: { ... },     // @ro 框架的插件
  viewport: { ... }   // 移动端适配（px 转 vw）
}
```

这些是 `@ro/core` 框架特有的配置，与 Webpack 无直接关系。