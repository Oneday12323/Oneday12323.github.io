---
title: WebView è¯¦è§£
tags: WebViewã€Containerã€Render Pipeline
article_header:
  type: cover
excerpt_separator: <!--more-->
---

## 1 WebView æ˜¯è°æä¾›çš„ï¼Ÿ

> WebView æ˜¯ç³»ç»Ÿçš„ **æµè§ˆå™¨æ§ä»¶ï¼ˆEmbedded Browser Engineï¼‰**ï¼Œå®ƒçš„èŒè´£å°±æ˜¯ï¼š  
> è®©å¼€å‘è€…åœ¨ App å†…æ˜¾ç¤ºç½‘é¡µï¼Œæ— è®ºç½‘é¡µæ¥è‡ªæœ¬åœ°è¿˜æ˜¯è¿œç¨‹æœåŠ¡å™¨ã€‚  
> å®ƒä¸æ˜¯ App çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰æä¾›çš„å—æ§æµè§ˆå™¨æ²™ç›’ã€‚  
> App é€šè¿‡ç³»ç»Ÿ API åˆ›å»ºå¹¶ç®¡ç† WebView å®ä¾‹ï¼Œä»è€Œå…·å¤‡â€œå†…åµŒæµè§ˆå™¨â€èƒ½åŠ›ã€‚

<!--more-->

| å¹³å° | æä¾›æ–¹ | åº•å±‚å®ç° |
|------|--------|----------|
| **Android** | Android ç³»ç»Ÿçš„ `android.webkit.WebView`ï¼Œåº•å±‚åŸºäº **Chromium å†…æ ¸**ï¼ˆç³»ç»Ÿè‡ªå¸¦æˆ–é€šè¿‡ Google WebView APK æ›´æ–°ï¼‰ | é€šè¿‡ JNI è°ƒç”¨åˆ° Chromium æ¸²æŸ“å¼•æ“ |
| **iOS** | Apple æä¾›çš„ `WKWebView`ï¼ˆå±äº **WebKit** æ¡†æ¶ï¼‰ | ä½¿ç”¨ WebKit å†…æ ¸ï¼Œä¸ Safari åŒæº |

WebView å†…éƒ¨ç‰¹æ€§åŒ…æ‹¬ï¼š
- å†…ç½® **ç½‘ç»œæ ˆï¼ˆnetwork stackï¼‰**ï¼Œå¯å‘èµ· HTTP(S) è¯·æ±‚ï¼›
- æ‹¥æœ‰ **HTML/CSS/JS æ¸²æŸ“å¼•æ“**ï¼›
- å¯æ‰§è¡Œ JSã€è§£æ DOMã€åŠ è½½èµ„æºï¼Œè¡Œä¸ºä¸æµè§ˆå™¨ä¸€è‡´ã€‚

**ç¤ºä¾‹ï¼š**
```java
webview.loadUrl("https://www.baidu.com");
````

æˆ–

```swift
webView.load(URLRequest(url: URL(string: "https://example.com")!))
```

æœ¬è´¨ä¸Šè¿™è¡Œä»£ç æ‰§è¡Œçš„æµç¨‹æ˜¯ï¼š

> å¯åŠ¨å†…æ ¸ â†’ å‘èµ· HTTP è¯·æ±‚ â†’ ä¸‹è½½ HTML â†’ æ¸²æŸ“é¡µé¢ã€‚

ç³»ç»Ÿä¸ä¼šé™åˆ¶ URL æ¥æºï¼Œå› ä¸º WebView çš„ä½¿å‘½å°±æ˜¯â€”â€”**æ¸²æŸ“ç½‘é¡µ**ã€‚

---

## 2 WebView çš„è¿è¡Œç¯å¢ƒ

> WebView çš„æ‰§è¡Œç¯å¢ƒå¯ä»¥ç†è§£ä¸ºä¸€ä¸ª **æ²™ç®±ç½‘é¡µè¿è¡Œå®¹å™¨ï¼ˆsandboxed web runtimeï¼‰**ï¼Œ
> å®ƒæ‹¥æœ‰ç‹¬ç«‹çš„æ¸²æŸ“å¼•æ“ã€JavaScript å¼•æ“ä¸ç½‘ç»œæ ˆï¼Œä¸ç³»ç»Ÿæµè§ˆå™¨ç±»ä¼¼ä½†ç›¸äº’ç‹¬ç«‹ã€‚

### 2.1 ç¯å¢ƒç»„æˆ

* **JS æ‰§è¡Œç¯å¢ƒ**ï¼šåŸºäºç³»ç»Ÿå†…æ ¸ï¼ˆChromium ä½¿ç”¨ **V8**ï¼ŒWebKit ä½¿ç”¨ **JavaScriptCore**ï¼‰ï¼Œä¸ App è‡ªèº« JS å¼•æ“éš”ç¦»ã€‚
* **èµ„æºåŠ è½½ç¯å¢ƒ**ï¼šé€šè¿‡æ ‡å‡† HTTP/HTTPS åè®®åŠ è½½èµ„æºï¼ˆæ”¯æŒç¼“å­˜ä¸ Cookie ç®¡ç†ï¼‰ï¼Œæˆ–è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚
* **å®‰å…¨é™åˆ¶**ï¼šå—æµè§ˆå™¨ **åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰** é™åˆ¶ã€‚å³åè®®ã€åŸŸåã€ç«¯å£å·éƒ½å¿…é¡»ç›¸åŒï¼Œä»¥é˜²æ­¢ä¸åŒæºç½‘é¡µäº’è®¿ã€‚
* **ç³»ç»Ÿæƒé™**ï¼šWebView ä¸å…·å¤‡åŸç”Ÿç³»ç»Ÿæƒé™ï¼ˆå¦‚ç›¸æœºã€æ—¥å†ã€é€šè®¯å½•ç­‰ï¼‰ï¼Œè‹¥éœ€è®¿é—®å¿…é¡»ç”± App æ˜¾å¼æ¡¥æ¥ï¼š

  * Android ä½¿ç”¨ `addJavascriptInterface`
  * iOS ä½¿ç”¨ `WKScriptMessageHandler`
* **æ¸²æŸ“å¼•æ“**ï¼šç‹¬ç«‹è´Ÿè´£ HTML/CSS è§£æä¸ç»˜åˆ¶ã€‚

> å› æ­¤ï¼ŒWebView å®é™…ä¸Šæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ App è¿›ç¨‹å†…ã€ä½†å—ç³»ç»Ÿå®‰å…¨éš”ç¦»çš„ç½‘é¡µå¼•æ“å®ä¾‹ã€‚

---

## 3 ä¸ºä»€ä¹ˆç³»ç»Ÿå…è®¸åŠ è½½ä»»æ„ç½‘é¡µï¼Ÿ

ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼š

* WebView æ˜¯é€šç”¨çš„æµè§ˆå™¨ç»„ä»¶ï¼›
* ç³»ç»Ÿæ— æ³•é¢„çŸ¥ä½ è¦åŠ è½½çš„æ˜¯æ–°é—»ã€å¹¿å‘Šã€æ–‡æ¡£è¿˜æ˜¯æ¸¸æˆï¼›
* åŠ è½½å†…å®¹ç”±å¼€å‘è€…å…¨æƒè´Ÿè´£ã€‚

å› æ­¤ç³»ç»Ÿé»˜è®¤æ˜¯å¼€æ”¾çš„ï¼š

* å…è®¸åŠ è½½ä»»æ„ URLï¼›
* æ”¯æŒ HTTP / HTTPS / file:// / content://ï¼›
* æ”¯æŒè·³è½¬ã€iframeã€JS æ‰§è¡Œï¼›
* ä¸åšåŸŸåç™½åå•é™åˆ¶ã€‚

> ç±»ä¼¼äºæµè§ˆå™¨ï¼š
> â€œå…è®¸è®¿é—®ä»»æ„ç½‘ç«™ï¼Œä½†é€šè¿‡åŒæºç­–ç•¥é˜²æ­¢è·¨ç«™è¶Šæƒã€‚â€

---

## 4 â€œèƒ½åŠ è½½ä»»æ„ç½‘é¡µâ€ â‰  â€œæ²¡æœ‰å®‰å…¨é™åˆ¶â€

è™½ç„¶ç³»ç»Ÿå¼€æ”¾åŠ è½½ç½‘é¡µï¼Œä½†æ‰§è¡Œå±‚é¢ä»å­˜åœ¨å¤šå±‚å®‰å…¨è¾¹ç•Œï¼š

### 4.1 ç½‘ç»œå®‰å…¨

* å—ç³»ç»Ÿé˜²ç«å¢™ã€ä»£ç†ã€TLS è¯ä¹¦æ ¡éªŒæ§åˆ¶ï¼›
* Android 9+ é»˜è®¤ç¦æ­¢æ˜æ–‡ HTTPï¼ˆéœ€ä½¿ç”¨ HTTPSï¼‰ã€‚

### 4.2 åŒæºç­–ç•¥

* ç½‘é¡µ A æ— æ³•è¯»å–ç½‘é¡µ B çš„ Cookieã€Storage æˆ– DOMï¼›
* WebView å†…çš„é¡µé¢é—´åŒæ ·å—æ­¤é™åˆ¶ã€‚

### 4.3 App â†” ç½‘é¡µæ¡¥æ¥é™åˆ¶

* Androidï¼š`addJavascriptInterface` ä»…å…è®¸å¸¦ `@JavascriptInterface` æ³¨è§£çš„æ–¹æ³•ï¼›
* iOSï¼š`WKScriptMessageHandler` åœ¨ç‹¬ç«‹æ²™ç®±ä¸­é€šä¿¡ï¼›
* æ— æ³•ç›´æ¥è®¿é—® App ç§æœ‰æ•°æ®ï¼Œé™¤é App ä¸»åŠ¨æš´éœ²æ¥å£ã€‚

### 4.4 åº”ç”¨å•†åº—å®¡æ ¸é™åˆ¶

App Store / Play Store çš„å®¡æ ¸è§„åˆ™è®¤ä¸ºï¼š

> è‹¥ WebView å¯åŠ è½½ä»»æ„è¿œç¨‹é€»è¾‘æˆ–è„šæœ¬ï¼Œå³å¯èƒ½æ„æˆ â€œè¿œç¨‹ä»£ç æ‰§è¡Œé£é™© (RCE)â€
> â†’ å¯¼è‡´æ‹’å®¡ã€‚

---

## 5 åŠ è½½ H5 é¡µé¢çš„é™åˆ¶

> WebView è™½èƒ½åŠ è½½ç½‘é¡µï¼Œä½†å¹¶éâ€œä»»æ„åŠ è½½â€éƒ½å®‰å…¨æˆ–èƒ½é€šè¿‡å®¡æ ¸ã€‚
> ç³»ç»Ÿä¸åº”ç”¨å•†åº—å±‚é¢å­˜åœ¨å¤šé‡çº¦æŸï¼š

### 5.1 åŠ è½½æ¥æºé™åˆ¶

* **iOS**ï¼šå®¡æ ¸è¦æ±‚é¡µé¢å¿…é¡»æ˜¯å†…ç½®èµ„æºæˆ–æ¥è‡ªå›ºå®šæœåŠ¡å™¨ã€‚
  ä»»æ„å¤–é“¾ï¼ˆå¦‚è¿œç¨‹å°æ¸¸æˆï¼‰è¢«åˆ¤å®šä¸ºâ€œçƒ­æ›´æ–°â€æˆ–â€œè¿œç¨‹é€»è¾‘ä¸‹å‘â€ â†’ æ‹’å®¡ã€‚
* **Android**ï¼šè¾ƒå®½æ¾ï¼Œä½†åŠ¨æ€è„šæœ¬æˆ–å¹¿å‘Š SDK åŒæ ·å¯èƒ½è¢«è­¦å‘Šæˆ–ä¸‹æ¶ã€‚

### 5.2 èµ„æºä¸æ‰§è¡Œé™åˆ¶

* ç¦æ­¢é HTTPSï¼›
* ç¦æ­¢æ‰§è¡Œä¸å—ä¿¡ä»»çš„ JSï¼ˆå¦‚ `eval` åŠ¨æ€ç”Ÿæˆä»£ç ï¼‰ï¼›
* ç¦æ­¢è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼ˆé™¤éé€šè¿‡ `file://` æ˜ç¡®æˆæƒï¼‰ï¼›
* éµå®ˆ **CSPï¼ˆContent-Security-Policyï¼‰**ï¼›
* ç¦æ­¢å†…åµŒæœªç»æˆæƒçš„æ”¯ä»˜ã€ç™»å½•ç­‰é«˜é£é™©é€»è¾‘ã€‚

### 5.3 å®¡æ ¸é£é™©ç‚¹

* è‹¥ URL æ¥æºå¯è¿œç¨‹é…ç½®ï¼›
* è‹¥å¤–éƒ¨ JS å¯æ‰§è¡Œï¼›
* è‹¥ UI æˆ–é€»è¾‘å¯çƒ­æ›´æ–°ï¼›
  â†’ éƒ½å¯èƒ½è¢«è§†ä¸ºâ€œè¿œç¨‹ä»£ç æ‰§è¡Œâ€é£é™©ã€‚

> Apple æ˜ç¡®è§„å®šï¼š
> åŠ è½½å›ºå®šèµ„æº âœ…
> åŠ è½½ä»»æ„ç½‘é¡µ ğŸš«ï¼ˆé«˜é£é™©è¡Œä¸ºï¼‰

---

## 6 WebView çš„æ¸²æŸ“è¿‡ç¨‹

> WebView çš„æ¸²æŸ“æµç¨‹å‡ ä¹ä¸æµè§ˆå™¨ä¸€è‡´ã€‚

### 6.1 æ•´ä½“æ¶æ„

```text
App è¿›ç¨‹
 â””â”€â”€ WebView æ§ä»¶
       â”œâ”€â”€ Rendererï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰
       â”‚     â”œâ”€â”€ HTML Parser
       â”‚     â”œâ”€â”€ DOM Tree / CSSOM
       â”‚     â”œâ”€â”€ Layout & Paint
       â”‚     â”œâ”€â”€ GPU Compositor
       â””â”€â”€ JS Engineï¼ˆV8 / JSCï¼‰
```

### 6.2 æ¸²æŸ“ç®¡çº¿æ­¥éª¤

1. **èµ„æºåŠ è½½**ï¼šç½‘ç»œçº¿ç¨‹ä¸‹è½½ HTML / CSS / JS / å›¾ç‰‡ç­‰ï¼›
2. **è§£æé˜¶æ®µ**ï¼šæ„å»º DOM æ ‘ä¸ CSSOMï¼›
3. **å¸ƒå±€è®¡ç®—ï¼ˆLayoutï¼‰**ï¼šæ ¹æ®æ ·å¼è®¡ç®—å…ƒç´ çš„å‡ ä½•ä¿¡æ¯ï¼›
4. **ç»˜åˆ¶ï¼ˆPaintï¼‰**ï¼šç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤ï¼›
5. **åˆæˆï¼ˆCompositingï¼‰**ï¼šGPU åˆæˆå›¾å±‚ï¼Œæœ€ç»ˆæ˜¾ç¤ºã€‚

ä¸å°æ¸¸æˆå®¹å™¨ç›¸æ¯”ï¼š

* WebView æ¸²æŸ“ä¾èµ–æµè§ˆå™¨å†…æ ¸ï¼›
* æ¸¸æˆå®¹å™¨åˆ™é€šè¿‡è‡ªç ” JS å¼•æ“ + åŸç”Ÿ GPU æ¥å£ï¼ˆOpenGL / Metal / Vulkanï¼‰ç›´æ¥æ¸²æŸ“ã€‚

---

## 7 WebView vs å°æ¸¸æˆå®¹å™¨ å¯¹æ¯”

| å¯¹æ¯”ç»´åº¦       | **WebView**                           | **å°æ¸¸æˆå®¹å™¨**                                |
| ---------- | ------------------------------------- | ---------------------------------------- |
| **æä¾›æ–¹**    | æ“ä½œç³»ç»Ÿï¼ˆAndroid / iOSï¼‰                   | å¹³å°æ–¹ï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ã€æŠ–éŸ³ç­‰è‡ªç ”ï¼‰                        |
| **ç›®æ ‡å®šä½**   | é€šç”¨ç½‘é¡µæ¸²æŸ“å¼•æ“                              | ä¸“ç”¨ JS æ¸¸æˆè¿è¡Œç¯å¢ƒ                             |
| **JS å¼•æ“**  | ç³»ç»Ÿå†…æ ¸ï¼šV8ï¼ˆAndroidï¼‰/ JavaScriptCoreï¼ˆiOSï¼‰ | è‡ªç ” JS è™šæ‹Ÿæœºï¼ˆè½»é‡åŒ–ï¼Œå¯æ§æ‰§è¡Œç¯å¢ƒï¼‰                    |
| **æ¸²æŸ“æœºåˆ¶**   | æµè§ˆå™¨å†…æ ¸å®Œæˆ DOM + CSS æ¸²æŸ“ï¼Œå†äº¤ç»™ GPU åˆæˆ       | é€šè¿‡ JS æ¡¥æ¥ GPU æ¥å£ï¼ˆå¦‚ OpenGL / Metalï¼‰ç›´æ¥ç»˜åˆ¶å¸§ç¼“å†² |
| **èµ„æºåŠ è½½**   | ä»»æ„ç½‘ç»œèµ„æºï¼ˆHTTP/HTTPS/fileï¼‰               | é™å®šè·¯å¾„æˆ–å¹³å°å†…å®¹åˆ†å‘ç³»ç»Ÿï¼ˆCDN + åŠ ç­¾æ ¡éªŒï¼‰                |
| **é€»è¾‘å¯å˜æ€§**  | é«˜ï¼Œå¯åŠ è½½ä»»æ„è¿œç«¯ç½‘é¡µ                           | ä½ï¼Œèµ„æºå›ºå®šï¼Œé€»è¾‘åŒ…ç»ç­¾åå®¡æ ¸                          |
| **ç³»ç»Ÿæƒé™è®¿é—®** | éœ€æ˜¾å¼æ¡¥æ¥ï¼›å—å¹³å°å®‰å…¨é™åˆ¶                         | æä¾›å°è£…å¥½çš„ API ç™½åå•ï¼ˆå¦‚ç³»ç»Ÿç›¸å†Œã€å®šä½ç­‰ï¼‰                |
| **å®‰å…¨æ€§**    | å—åŒæºç­–ç•¥å’Œæµè§ˆå™¨æ²™ç®±ä¿æŠ¤                         | å—å¹³å°å®‰å…¨ç­–ç•¥ä¸èµ„æºç­¾åä¿æŠ¤                           |
| **å®¡æ ¸é£é™©**   | é«˜ï¼šæ˜“è¢«åˆ¤å®šä¸ºçƒ­æ›´æ–°æˆ–è¿œç¨‹æ‰§è¡Œ                       | ä½ï¼šé€»è¾‘å›ºå®šã€èµ„æºå—æ§                              |
| **æ€§èƒ½ä¼˜åŒ–**   | åé‡ç½‘é¡µæ¸²æŸ“ä¼˜åŒ–ï¼ˆç¼“å­˜ã€å¸ƒå±€ã€GPU åˆæˆï¼‰                | åé‡å¸§ç‡ä¸å†…å­˜æ§åˆ¶ï¼ˆå®æ—¶æ¸²æŸ“ä¼˜åŒ–ï¼‰                        |

> æ€»ä½“æ¥è¯´ï¼ŒWebView æ˜¯â€œæµè§ˆå™¨å¼é€šç”¨ç½‘é¡µå®¹å™¨â€ï¼Œçµæ´»ä½†å®‰å…¨é£é™©é«˜ï¼›
> å°æ¸¸æˆå®¹å™¨æ˜¯â€œå°é—­å¯æ§æ‰§è¡Œç¯å¢ƒâ€ï¼Œçµæ´»æ€§è¾ƒä½ä½†è¿è¡Œæ•ˆç‡ä¸å®‰å…¨æ€§æ›´é«˜ã€‚

---

## 8 é™„å½•ï¼šåŠ è½½ H5 çš„é¢å¤–æ³¨æ„äº‹é¡¹

* **ç™½åå•æœºåˆ¶**ï¼šéƒ¨åˆ†å¹³å°è¦æ±‚å£°æ˜å…è®¸çš„åŸŸååˆ—è¡¨ï¼›
* **è·¨åŸŸé™åˆ¶**ï¼šéœ€é€šè¿‡ **CORS** æœºåˆ¶å…è®¸è·¨åŸŸè¯·æ±‚ï¼›
* **å®‰å…¨é™åˆ¶**ï¼šç¦æ­¢ç›´æ¥è®¿é—® App ç§æœ‰ç›®å½•ï¼›
* **æ€§èƒ½é™åˆ¶**ï¼šå¤æ‚é¡µé¢æ¸²æŸ“æ€§èƒ½ä¸å¦‚åŸç”Ÿï¼›
* **åŠŸèƒ½é™åˆ¶**ï¼šéƒ¨åˆ† HTML5 / CSS3 / JS API å¯èƒ½ä¸è¢«æ”¯æŒï¼›
* **ç”¨æˆ·ä½“éªŒ**ï¼šæ»šåŠ¨ã€åŠ¨ç”»ã€è§¦æ‘¸å“åº”ä¸åŸç”Ÿæœ‰å·®å¼‚ï¼›
* **è°ƒè¯•é™åˆ¶**ï¼šéœ€ä½¿ç”¨è¿œç¨‹è°ƒè¯•å·¥å…·ï¼ˆå¦‚ Chrome DevTools æˆ– Safari Web Inspectorï¼‰ï¼›
* **ç‰ˆæœ¬å·®å¼‚**ï¼šä¸åŒç³»ç»Ÿç‰ˆæœ¬ WebView å†…æ ¸å·®å¼‚è¾ƒå¤§ï¼Œéœ€å¤šç‰ˆæœ¬æµ‹è¯•ã€‚

> å› æ­¤åœ¨å®é™…å¼€å‘ä¸­ï¼ŒåŠ è½½ H5 é¡µé¢æ—¶åº”å……åˆ†è€ƒè™‘ä¸Šè¿°é™åˆ¶ï¼Œ
> ä»¥ç¡®ä¿å®‰å…¨æ€§ã€æ€§èƒ½ä¸ç”¨æˆ·ä½“éªŒçš„å¹³è¡¡ã€‚

